

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>APIC High Availablity and Clustering &mdash; ACI Troubleshooting Book 0.0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="ACI Troubleshooting Book 0.0.1 documentation" href="index.html"/>
        <link rel="next" title="Firmware and Image Management" href="firmware.html"/>
        <link rel="prev" title="Fabric Initialization" href="fabric_init.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> ACI Troubleshooting Book</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="preface.html#authors-and-contributors">Authors and Contributors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#authors">Authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#distinguished-contributors">Distinguished Contributors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#dedications">Dedications</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#acknowledgments">Acknowledgments</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#book-writing-methodology">Book Writing Methodology</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#who-should-read-this-book">Who Should Read This Book?</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#organization-of-this-book">Organization of this Book</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="aci.html">Application Centric Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="aci_policy_model.html">ACI Policy Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#abstraction-model">Abstraction Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#everything-is-an-object">Everything is an Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#relevant-objects-and-relationships">Relevant Objects and Relationships</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#hierarchical-aci-object-model-and-the-infrastructure">Hierarchical ACI Object Model and the Infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#infrastructure-as-objects">Infrastructure as Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#build-object-use-object-to-build-policy-reuse-policy">Build object, use object to build policy, reuse policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#rest-api-just-exposes-the-object-model">REST API just exposes the object model</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#logical-model-resolved-model-concrete-model">Logical model, Resolved model, concrete model</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#formed-and-unformed-relationships">Formed and Unformed Relationships</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#declarative-end-state-and-promise-theory">Declarative End State and Promise Theory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Troubleshooting Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tools.html#apic-access-methods">APIC Access Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#programmatic-configuration-python">Programmatic Configuration (Python)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#fabric-node-access-methods">Fabric Node Access Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#exporting-information-from-the-fabric">Exporting information from the Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#external-data-collection-syslog-snmp-call-home">External Data Collection – Syslog, SNMP, Call-Home</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#health-scores">Health Scores</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#atomic-counters">Atomic Counters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ts_methodology.html">Troubleshooting Methodology</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ts_methodology.html#overall-methodology">Overall Methodology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="topology.html">Sample Reference Topology</a><ul>
<li class="toctree-l2"><a class="reference internal" href="topology.html#physical-fabric-topology">Physical Fabric Topology</a></li>
<li class="toctree-l2"><a class="reference internal" href="topology.html#logical-application-topology">Logical Application Topology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#naming-conventions">Naming Conventions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hw_bringup.html">Initial Hardware Bringup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hw_bringup.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_bringup.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_bringup.html#id2">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fabric_init.html">Fabric Initialization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fabric_init.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="fabric_init.html#fabric-verification">Fabric Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="fabric_init.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Application Policy Infrastructure Controller (APIC) High Availability and Clustering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cluster-formation">Cluster Formation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#majority-and-minority-handling-clustering-split-brains">Majority and Minority - Handling Clustering Split Brains</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id15">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="firmware.html">Firmware and Image Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#id1">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#id5">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="health.html">Faults / Health Scores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="health.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="health.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="health.html#id1">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rest.html">REST Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="rest.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="rest.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mgmt_tn.html">Management Tenant</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mgmt_tn.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="mgmt_tn.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="mgmt_tn.html#id1">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common Network Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="common.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="common.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="common.html#id15">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="unicast.html">Unicast Data Plane Forwarding and Reachability</a><ul>
<li class="toctree-l2"><a class="reference internal" href="unicast.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicast.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicast.html#id1">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pol_cntr.html">Policies and Contracts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pol_cntr.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="pol_cntr.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bridged2ext.html">Bridged Connectivity to External Networks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="bridged2ext.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridged2ext.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridged2ext.html#id3">Problem Description:</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridged2ext.html#id5">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="routed2ext.html">Routed Connectivity to External Networks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#fabric-verification">Fabric Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#problem-description">Problem description</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#id1">Problem description</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#id3">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vmm_ucs.html">Virtual Machine Manager and UCS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#id2">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#id6">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#id9">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="l4l7.html">L4-L7 Service Insertion</a><ul>
<li class="toctree-l2"><a class="reference internal" href="l4l7.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="l4l7.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fn_crash_ts.html">ACI Fabric Node and Process Crash Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fn_crash_ts.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="fn_crash_ts.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apic_crash_ts.html">APIC Process Crash Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="apic_crash_ts.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic_crash_ts.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#overview">Overview</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ACI Troubleshooting Book</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div></div>
          <div role="main" class="document">
            
  <div class="section" id="apic-high-availablity-and-clustering">
<h1>APIC High Availablity and Clustering<a class="headerlink" href="#apic-high-availablity-and-clustering" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id18">Overview</a></li>
<li><a class="reference internal" href="#cluster-formation" id="id19">Cluster Formation</a></li>
<li><a class="reference internal" href="#majority-and-minority-handling-clustering-split-brains" id="id20">Majority and Minority - Handling Clustering Split Brains</a></li>
<li><a class="reference internal" href="#problem-description" id="id21">Problem Description</a><ul>
<li><a class="reference internal" href="#symptom" id="id22">Symptom</a></li>
<li><a class="reference internal" href="#verification" id="id23">Verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id1" id="id24">Problem Description</a><ul>
<li><a class="reference internal" href="#id2" id="id25">Symptom</a></li>
<li><a class="reference internal" href="#id3" id="id26">Verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id4" id="id27">Problem Description</a><ul>
<li><a class="reference internal" href="#id5" id="id28">Symptom</a></li>
<li><a class="reference internal" href="#resolution" id="id29">Resolution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6" id="id30">Problem Description</a><ul>
<li><a class="reference internal" href="#id7" id="id31">Symptom</a></li>
<li><a class="reference internal" href="#id8" id="id32">Resolution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id9" id="id33">Problem Description</a><ul>
<li><a class="reference internal" href="#id10" id="id34">Symptom</a></li>
<li><a class="reference internal" href="#id11" id="id35">Resolution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id12" id="id36">Problem Description</a><ul>
<li><a class="reference internal" href="#id13" id="id37">Symptom</a></li>
<li><a class="reference internal" href="#id14" id="id38">Resolution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id15" id="id39">Problem Description</a><ul>
<li><a class="reference internal" href="#id16" id="id40">Symptom</a></li>
<li><a class="reference internal" href="#id17" id="id41">Resolution</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id18">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This chapter covers the APIC clustering operations. Clustering provides for
high availability, data protection and scaling by distributed data storage and
processing across the APIC controllers. While every unit of data in the object
model is handled by a single controller, all units are replicated 3 times
across the cluster to other controller nodes, regardless of the size of the
cluster. Clustering makes the system highly resilient to process crashes and
corrupted databases by eliminating single points of failure.</p>
<p>The APIC process that handles clustering is the Appliance Director process.
The Appliance Director process runs in every controller and is specifically in
charge of synchronizing information across all nodes in the cluster. While
Appliance Director is in charge of performing periodic heartbeats to track the
availability of other controllers, actual replication of data is done by each
respective service independently. For example, Policy Manager on one
controller is in charge to replicate its data to the Policy Manager instances
in other controllers. Appliance Director only participates in indicating
processes or services on which other controllers are their replicas set up in.</p>
<p>Each controller node in the cluster is uniquely identified by an ID. This ID
is configured by the administrator at the time of initial configuration.</p>
</div>
<div class="section" id="cluster-formation">
<h2><a class="toc-backref" href="#id19">Cluster Formation</a><a class="headerlink" href="#cluster-formation" title="Permalink to this headline">¶</a></h2>
<p>The following list of necessary conditions has to be met for successful
cluster formation:</p>
<ul class="simple">
<li>Candidate APICs must have been configured with matching admin user
credentials to be part of cluster.</li>
<li>When adding controller nodes to the cluster, the administratively configured
cluster size must not be exceeded.</li>
<li>When a new node is added, its specified cluster size must match the
configured cluster size on all other nodes in the cluster.</li>
<li>Every node must have connectivity to all other nodes in the cluster.</li>
<li>There must be a data exchange between reachable controller pairs.</li>
</ul>
<p>In our sample reference topology, 3 controllers are being used, namely APIC1,
APIC2, and APIC3. The process flow for forming the cluster is as follows:</p>
<p>APIC1 enters a state where the status shows an operational cluster size of 1
and the controller&#8217;s health of &#8220;fully-fit&#8221; in the GUI. During the setup
script, the administrative cluster size was configured as 3. Once the fabric
discovery has converged to the point where APIC1 has formed relationships with
the fabric node switches, providing connectivity to APIC2, APIC1 and APIC2
will establish a data exchange and APIC2 will start sending heartbeats. Once
APIC1 receives heartbeats from APIC2, APIC1 increments the operational cluster
size to 2 and allows APIC2 to join the cluster. The discovery process
continues and detects a third controller, and the cluster operational size is
incremented again by a value of 1. This process of fabric and controller
discovery continues until the operational cluster size reaches the configured
administrative cluster size. In our reference topology, the administrative
cluster size is 3 and when APIC3 joins the cluster, the operational cluster
size is 3, and the cluster formation is complete.</p>
</div>
<div class="section" id="majority-and-minority-handling-clustering-split-brains">
<h2><a class="toc-backref" href="#id20">Majority and Minority - Handling Clustering Split Brains</a><a class="headerlink" href="#majority-and-minority-handling-clustering-split-brains" title="Permalink to this headline">¶</a></h2>
<p>Due to the fundamental functionality of data replication, any ACI fabric has a
minimum supported APIC cluster size of 3. With clustering operations, APICs
leverage the concept of majority and minority. Majority and minority are used
to resolve potential split brain scenarios. In a case where split brain has
occurred, 2 APICs, such as APIC1 and APIC2, can communicate with each other
but not with APIC3, and APIC3 is not able to communicate with either APIC1 or
APIC2. Since there were an odd number of controllers to start with, APIC1 and
APIC2 are considered to be the majority and APIC3 is the minority. If there
were, to start with, an even number of APIC controllers, it will be more
difficult to resolve which are the majority vs minority.</p>
<p>When an APIC controller network connectivity is lost to other controllers, it
transitions into a minority state, while if the other controllers continue to
be reachable in between, the still connected controllers represent a majority.
In a minority state, the APIC enters a read only mode where no configuration
changes are allowed. No incoming updates from any of the fabric switch nodes
are handled by the minority controller(s) and if any VMM integration exists,
incoming updates from hypervisors are ignored.</p>
<p>While an APIC remains in minority state, read requests will be allowed but
will return data with an indication that the data could be stale.</p>
<p>In the scenario of loss of network connectivity resulting in the partitioning
of the fabric and an APIC in minority state, if an endpoint attaches to a leaf
managed by an APIC in minority state, the leaf will download and instantiate a
potentially state policy from the minority controller. Once all controllers
regain connectivity to each other and the split brain condition has been
resolved, if a more recent or updated copy of the policy exists between the
majority clusters, the leaf will download and update the policy accordingly.</p>
</div>
<div class="section" id="problem-description">
<h2><a class="toc-backref" href="#id21">Problem Description</a><a class="headerlink" href="#problem-description" title="Permalink to this headline">¶</a></h2>
<p>When adding or replacing APIC within an existing cluster, potentially an issue
can be encountered where APIC is not able to join the existing APIC cluster.</p>
<div class="section" id="symptom">
<h3><a class="toc-backref" href="#id22">Symptom</a><a class="headerlink" href="#symptom" title="Permalink to this headline">¶</a></h3>
<p>During fabric bring up or expansion, APIC1 is the only controller online, and
APIC3 is being inserted before APIC2, therefore APIC3 will not join the fabric.</p>
</div>
<div class="section" id="verification">
<h3><a class="toc-backref" href="#id23">Verification</a><a class="headerlink" href="#verification" title="Permalink to this headline">¶</a></h3>
<p>Under System-&gt;Controller-Faults, verify the existence of the following fault:</p>
<a class="reference internal image-reference" href="_images/IntrusionFault.png"><img alt="_images/IntrusionFault.png" class="align-center" src="_images/IntrusionFault.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The fault message indicates that APIC3 cannot join the fabric before APIC2
joins the fabric. The problem will be resolved once APIC2 is brought up, then
APIC3 will be able to join the cluster.</p>
</div>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id24">Problem Description</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Policy changes are not allowed on APIC1 even though APIC1 is healthy and fully
fit.</p>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id25">Symptom</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>APIC2 and APIC3 are not functional (shutdown or disconnected) while APIC1 is
fully functional.</p>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id26">Verification</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Under System-&gt;Controllers-&gt;Cluster APIC2 and APIC2 have an operational status
of &#8220;Unavailable&#8221;</p>
<a class="reference internal image-reference" href="_images/OperState_APIC2_APIC3_Unavailable.png"><img alt="_images/OperState_APIC2_APIC3_Unavailable.png" class="align-center" src="_images/OperState_APIC2_APIC3_Unavailable.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>When trying to create a new policy, the following status message is seen:</p>
<a class="reference internal image-reference" href="_images/minority.png"><img alt="_images/minority.png" class="align-center" src="_images/minority.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>These symptoms indicated that APIC1 is in the minority state and it thinks
that APIC2 and APIC3 are still online, but APIC1 lost connectivity to both of
these APICs via infrastructure VLAN.</p>
<p>One of the missing APIC, APIC2 or APIC3 needs to be powered up to resolve this
error. Let&#8217;s say when APIC1 and APIC3 become part of the cluster again, APIC1
and APIC3 will be in the majority state where APIC2 (still offline) will be in
the minority state.</p>
<div class="section" id="types-of-cluster-faults">
<h4>Types of Cluster Faults<a class="headerlink" href="#types-of-cluster-faults" title="Permalink to this headline">¶</a></h4>
<p>Cluster-related faults are designed to provide diagnostic information which is
sufficient to correct detected faulty conditions. There are 2 major groups of
faults - faults related to messages which are discarded by ApplianceDirector
process on the receiving APIC, and faults related to cluster geometry changes.</p>
<p>Faults related to messages which are discarded by the ApplianceDirector
process running on the APIC receiving the messages are then examined from the
following two perspectives:</p>
<ol class="arabic simple">
<li>Is this message from a cluster peer</li>
<li>If not, is it from an APIC which might be considered as a candidate for
cluster expansion</li>
</ol>
<p>Consequently, there will be an attempt to raise two faults (<strong>F1370</strong>
and <strong>F1410</strong>)if the received message fails to qualify either check and is
discarded by recipient.</p>
<p>There has to be a continuous stream of similar messages arriving over a period
of time for a fault to be raised. Once the fault is raised, it contains
information about the APIC experiencing the failure, including the serial
number, cluster ID, and time when the stream of similar messages started to
arrive.</p>
</div>
</div>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id27">Problem Description</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>A cluster with Operational ClusterSize equal to 3 will not accept an APIC as
an addition or replacement which claims Operational Cluster Size equal to 5.</p>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id28">Symptom</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>A fault code of 1370 with a reason of
&#8220;<strong>operational-cluster-size-distance-cannot-be-bridged</strong>&#8221; will be raised if the
APIC trying to join has OperationalClusterSize that deviates from cluster’s
OperationalClusterSize by more than 1.</p>
</div>
<div class="section" id="resolution">
<h3><a class="toc-backref" href="#id29">Resolution</a><a class="headerlink" href="#resolution" title="Permalink to this headline">¶</a></h3>
<p>Change the operational cluster size on the new APIC to match from the initial
setup script, or be only 1 greater than what is configured on the current
fabric.</p>
</div>
</div>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id30">Problem Description</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>A controllers configuration is erased, the server is restarted and the
controller is brought back into the cluster.</p>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id31">Symptom</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>A fault code of 1370 with a reason of
&#8220;<strong>source-has-mismatched-target-chassis-id</strong>&#8221; will be raised when an trying to
join the cluster has a new Chassis ID from what it was previosly known by
other controllers.</p>
</div>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#id32">Resolution</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>The corrective action is to decommission the server which its configuration
was erased from any other controller, and commission back. The clusters will
then be able to merge with the controller that has been brought back online.</p>
</div>
</div>
<div class="section" id="id9">
<h2><a class="toc-backref" href="#id33">Problem Description</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<p>Adding subsequent controllers beyond a number of 3 on a cluster previously
configured with a size of 3 will result in a system fault and the new
controller not joining the cluster.</p>
<div class="section" id="id10">
<h3><a class="toc-backref" href="#id34">Symptom</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>A fault code of 1370 with a reason of
&#8220;<strong>source-id-is-outside-operational-cluster-size</strong>&#8221; is raised when the
transmitting APIC has a cluster ID which doesn’t fit into cluster with current
OperationalClusterSize.</p>
</div>
<div class="section" id="id11">
<h3><a class="toc-backref" href="#id35">Resolution</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Change the cluster ID to be with the range of the defined cluster size from
the setup script. The chosen cluster ID should be 1 greater than the current
defined size It may be required to grow the cluster.</p>
</div>
</div>
<div class="section" id="id12">
<h2><a class="toc-backref" href="#id36">Problem Description</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<p>Adding a currently decomissioned server back into the cluster results in a
fault.</p>
<div class="section" id="id13">
<h3><a class="toc-backref" href="#id37">Symptom</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>A fault code of 1370 with a reason of <strong>source-is-not-commissioned</strong> is raised
when the transmitting APIC has a cluster ID which is currently decommissioned
in the cluster.</p>
</div>
<div class="section" id="id14">
<h3><a class="toc-backref" href="#id38">Resolution</a><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>Commission the APIC.</p>
</div>
</div>
<div class="section" id="id15">
<h2><a class="toc-backref" href="#id39">Problem Description</a><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p>Adding a controller from another fabric fails to join the cluster.</p>
<div class="section" id="id16">
<h3><a class="toc-backref" href="#id40">Symptom</a><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>A fault code of 1370 with a reason of <strong>fabric-domain-mismatch</strong> is raised when
the transmitting APIC has a FabricID which is different from FabricID in the
formed cluster.</p>
</div>
<div class="section" id="id17">
<h3><a class="toc-backref" href="#id41">Resolution</a><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>Run the APIC CLI command <strong>acidiag eraseconfig setup</strong> and set the correct
FabricID on the APIC from the setup script.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="firmware.html" class="btn btn-neutral float-right" title="Firmware and Image Management">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="fabric_init.html" class="btn btn-neutral" title="Fabric Initialization"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Andres Vega, Bryan Deaver, Jerry Ye, Kannan Ponnuswamy, Loy Evans, Mike Timm, Paul Lesiak and Paul Raytick.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
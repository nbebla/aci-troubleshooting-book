

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Bridged Connectivity to External Networks &mdash; ACI Troubleshooting Book 0.0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="ACI Troubleshooting Book 0.0.1 documentation" href="index.html"/>
        <link rel="next" title="Routed Connectivity to External Networks" href="routed2ext.html"/>
        <link rel="prev" title="Policies and Contracts" href="pol_cntr.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> ACI Troubleshooting Book</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="preface.html#authors-and-contributors">Authors and Contributors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#authors">Authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#distinguished-contributors">Distinguished Contributors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#dedications">Dedications</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#acknowledgments">Acknowledgments</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#book-writing-methodology">Book Writing Methodology</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#who-should-read-this-book">Who Should Read This Book?</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#organization-of-this-book">Organization of this Book</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="aci.html">Application Centric Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="aci_policy_model.html">ACI Policy Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#abstraction-model">Abstraction Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#everything-is-an-object">Everything is an Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#relevant-objects-and-relationships">Relevant Objects and Relationships</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#hierarchical-aci-object-model-and-the-infrastructure">Hierarchical ACI Object Model and the Infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#infrastructure-as-objects">Infrastructure as Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#build-object-use-object-to-build-policy-reuse-policy">Build object, use object to build policy, reuse policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#rest-api-just-exposes-the-object-model">REST API just exposes the object model</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#logical-model-resolved-model-concrete-model">Logical model, Resolved model, concrete model</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#formed-and-unformed-relationships">Formed and Unformed Relationships</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#declarative-end-state-and-promise-theory">Declarative End State and Promise Theory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Troubleshooting Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tools.html#apic-access-methods">APIC Access Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#programmatic-configuration-python">Programmatic Configuration (Python)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#fabric-node-access-methods">Fabric Node Access Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#exporting-information-from-the-fabric">Exporting information from the Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#external-data-collection-syslog-snmp-call-home">External Data Collection â€“ Syslog, SNMP, Call-Home</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#health-scores">Health Scores</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#atomic-counters">Atomic Counters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ts_methodology.html">Troubleshooting Methodology</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ts_methodology.html#overall-methodology">Overall Methodology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="topology.html">Sample Reference Topology</a><ul>
<li class="toctree-l2"><a class="reference internal" href="topology.html#physical-fabric-topology">Physical Fabric Topology</a></li>
<li class="toctree-l2"><a class="reference internal" href="topology.html#logical-application-topology">Logical Application Topology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#naming-conventions">Naming Conventions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hw_bringup.html">Initial Hardware Bringup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hw_bringup.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_bringup.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_bringup.html#id2">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fabric_init.html">Fabric Initialization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fabric_init.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="fabric_init.html#fabric-verification">Fabric Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="fabric_init.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apic.html">Application Policy Infrastructure Controller (APIC) High Availability and Clustering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="apic.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#cluster-formation">Cluster Formation</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#majority-and-minority-handling-clustering-split-brains">Majority and Minority - Handling Clustering Split Brains</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id1">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id4">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id6">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id9">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id12">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id15">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="firmware.html">Firmware and Image Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#id1">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#id5">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="health.html">Faults / Health Scores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="health.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="health.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="health.html#id1">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rest.html">REST Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="rest.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="rest.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mgmt_tn.html">Management Tenant</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mgmt_tn.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="mgmt_tn.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="mgmt_tn.html#id1">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common Network Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="common.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="common.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="common.html#id15">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="unicast.html">Unicast Data Plane Forwarding and Reachability</a><ul>
<li class="toctree-l2"><a class="reference internal" href="unicast.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicast.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicast.html#id1">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pol_cntr.html">Policies and Contracts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pol_cntr.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="pol_cntr.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Bridged Connectivity to External Networks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">Problem Description:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="routed2ext.html">Routed Connectivity to External Networks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#fabric-verification">Fabric Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#problem-description">Problem description</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#id1">Problem description</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#id3">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vmm_ucs.html">Virtual Machine Manager and UCS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#id2">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#id6">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#id9">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="l4l7.html">L4-L7 Service Insertion</a><ul>
<li class="toctree-l2"><a class="reference internal" href="l4l7.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="l4l7.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fn_crash_ts.html">ACI Fabric Node and Process Crash Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fn_crash_ts.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="fn_crash_ts.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apic_crash_ts.html">APIC Process Crash Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="apic_crash_ts.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic_crash_ts.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#overview">Overview</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ACI Troubleshooting Book</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div></div>
          <div role="main" class="document">
            
  <div class="section" id="bridged-connectivity-to-external-networks">
<h1>Bridged Connectivity to External Networks<a class="headerlink" href="#bridged-connectivity-to-external-networks" title="Permalink to this headline">Â¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id12">Overview</a></li>
<li><a class="reference internal" href="#problem-description" id="id13">Problem Description</a><ul>
<li><a class="reference internal" href="#symptom-1" id="id14">Symptom 1</a></li>
<li><a class="reference internal" href="#verification" id="id15">Verification</a></li>
<li><a class="reference internal" href="#resolution" id="id16">Resolution</a></li>
<li><a class="reference internal" href="#symptom-2" id="id17">Symptom 2</a></li>
<li><a class="reference internal" href="#id1" id="id18">Verification</a></li>
<li><a class="reference internal" href="#id2" id="id19">Resolution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id3" id="id20">Problem Description:</a><ul>
<li><a class="reference internal" href="#symptom-3" id="id21">Symptom 3</a></li>
<li><a class="reference internal" href="#verification-resolution" id="id22">Verification/Resolution</a></li>
<li><a class="reference internal" href="#symptom-4" id="id23">Symptom 4</a></li>
<li><a class="reference internal" href="#id4" id="id24">Verification/Resolution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5" id="id25">Problem Description</a><ul>
<li><a class="reference internal" href="#id6" id="id26">Symptom 1</a></li>
<li><a class="reference internal" href="#id7" id="id27">Verification</a></li>
<li><a class="reference internal" href="#id8" id="id28">Resolution</a></li>
<li><a class="reference internal" href="#id9" id="id29">Symptom 2</a></li>
<li><a class="reference internal" href="#id10" id="id30">Verification</a></li>
<li><a class="reference internal" href="#id11" id="id31">Resolution</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id12">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">Â¶</a></h2>
<p>This chapter covers potential issues that could occur with Bridged
Connectivity to External Networks, starting with an overview of how bridged
connectivity to external networks should function and the verification steps
used to confirm a working layer 2 bridged network for the example reference
topology fabric. The displays taken on a working fabric can then be used as an
aid in troubleshooting issues with external Layer 2 connectivity.</p>
<p>There are different ways to extend Layer 2 domain beyond the ACI fabric:</p>
<ul class="simple">
<li><strong>Extend the EPG out of the ACI fabric</strong> - A user can extend an EPG out of
the ACI fabric by statically assigning a port (along with VLAN ID) to an
EPG. The leaf will learn the endpoint information and assign the traffic (by
matching the port and VLAN ID) to the proper EPG, and then enforce the
policy. The endpoint learning, data forwarding, and policy enforcement
remain the same whether the endpoint is directly attached to the leaf port
or if it is behind a Layer 2 network (provided the proper VLAN is enabled in
the layer2 network).</li>
<li><strong>Extend the bridge domain out of the ACI fabric</strong> - This option is designed
to extend the entire bridge domain (not an individual EPG under bridge
domain) to the outside network.</li>
</ul>
</div>
<div class="section" id="problem-description">
<h2><a class="toc-backref" href="#id13">Problem Description</a><a class="headerlink" href="#problem-description" title="Permalink to this headline">Â¶</a></h2>
<p>There are many ways to connect ACI Leafs to external devices. The interface
properties could be access, trunk, port-channel, virtual port-channel, routed,
routed sub-interfaces, or SVI. When establishing Layer 2 connectivity with
external devices, itâ€™s important to match the properties such as VLANs tagged,
LACP modes, etc. This is equally applicable to networks hosted by ACI as well
as external networks.</p>
<p>When a configuration mismatch occurs, depending on the parameters, the
interfaces are either down, or not forwarding traffic as expected.</p>
<div class="section" id="symptom-1">
<h3><a class="toc-backref" href="#id14">Symptom 1</a><a class="headerlink" href="#symptom-1" title="Permalink to this headline">Â¶</a></h3>
<p>Interfaces connecting to the external devices are in down state.</p>
</div>
<div class="section" id="verification">
<h3><a class="toc-backref" href="#id15">Verification</a><a class="headerlink" href="#verification" title="Permalink to this headline">Â¶</a></h3>
<p>In this example, rtp_leaf1 and rtp_leaf3 need to form a vPC pair and connect
using a dedicated port-channel per UCS Fabric Interconnect. A virtual
port-channel has been configured, and the APIC has assigned port-channel4 as
seen below on rtp_leaf1 and rtp_leaf3.</p>
<p>Please note that although in this output both vPC ID (2) and Port (Po4) match
on both leafs, only the vPC ID need to match for this configuration to work.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show vpc</span>
<span class="go">Legend:</span>
<span class="go">                (*) - local vPC is down, forwarding via vPC peer-link</span>

<span class="go">vPC domain id                     : 10</span>
<span class="go">Peer status                       : peer adjacency formed ok</span>
<span class="go">vPC keep-alive status             : Disabled</span>
<span class="go">Configuration consistency status  : success</span>
<span class="go">Per-vlan consistency status       : success</span>
<span class="go">Type-2 inconsistency reason       : Consistency Check Not Performed</span>
<span class="go">vPC role                          : primary</span>
<span class="go">Number of vPCs configured         : 2</span>
<span class="go">Peer Gateway                      : Disabled</span>
<span class="go">Dual-active excluded VLANs        : -</span>
<span class="go">Graceful Consistency Check        : Enabled</span>
<span class="go">Auto-recovery status              : Enabled (timeout = 240 seconds)</span>
<span class="go">Operational Layer3 Peer           : Disabled</span>

<span class="go">vPC Peer-link status</span>
<span class="go">---------------------------------------------------------------------</span>
<span class="go">id   Port   Status Active vlans</span>
<span class="go">--   ----   ------ --------------------------------------------------</span>
<span class="go">1           up     -</span>

<span class="go">vPC status</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">id   Port   Status Consistency Reason                     Active vlans</span>
<span class="go">--   ----   ------ ----------- ------                     ------------</span>
<span class="go">2    Po4    down*  success     success                    -</span>
<span class="go">343  Po1    up     success     success                    700,751</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf3# show vpc</span>
<span class="go">Legend:</span>
<span class="go">                (*) - local vPC is down, forwarding via vPC peer-link</span>

<span class="go">vPC domain id                     : 10</span>
<span class="go">Peer status                       : peer adjacency formed ok</span>
<span class="go">vPC keep-alive status             : Disabled</span>
<span class="go">Configuration consistency status  : success</span>
<span class="go">Per-vlan consistency status       : success</span>
<span class="go">Type-2 inconsistency reason       : Consistency Check Not Performed</span>
<span class="go">vPC role                          : secondary</span>
<span class="go">Number of vPCs configured         : 2</span>
<span class="go">Peer Gateway                      : Disabled</span>
<span class="go">Dual-active excluded VLANs        : -</span>
<span class="go">Graceful Consistency Check        : Enabled</span>
<span class="go">Auto-recovery status              : Enabled (timeout = 240 seconds)</span>
<span class="go">Operational Layer3 Peer           : Disabled</span>
<span class="go"> vPC Peer-link status</span>
<span class="go">---------------------------------------------------------------------</span>
<span class="go">id   Port   Status Active vlans</span>
<span class="go">--   ----   ------ --------------------------------------------------</span>
<span class="go">1           up     -</span>

<span class="go">vPC status</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">id   Port   Status Consistency Reason                     Active vlans</span>
<span class="go">--   ----   ------ ----------- ------                     ------------</span>
<span class="go">2    Po4    down*  success     success                    -</span>
<span class="go">343  Po1    up     success     success                    700,751</span>
</pre></div>
</div>
<p>Since the interfaces are in the down (D) state, a check of interface status
would reveal if there is a potential layer 1 issue as seen below.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show interface ethernet 1/27</span>
<span class="go">Ethernet1/27 is down (sfp-speed-mismatch)</span>
<span class="go">admin state is up, Dedicated Interface</span>
</pre></div>
</div>
<p>On the GUI, Fabric -&gt; Inventory -&gt; Pod1 -&gt; leafname -&gt; Interfaces -&gt; vPC
Interfaces -&gt; &lt;vPC Domain ID&gt; -&gt; &lt;vPC ID&gt; -&gt; Faults, would reveal:</p>
<a class="reference internal image-reference" href="_images/13.png"><img alt="_images/13.png" class="align-center" src="_images/13.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="resolution">
<h3><a class="toc-backref" href="#id16">Resolution</a><a class="headerlink" href="#resolution" title="Permalink to this headline">Â¶</a></h3>
<p>Configure the interface policies to match the peer device. In this scenario,
the speed mismatch was addressed by changing the interface policy from 1G to
10G.</p>
</div>
<div class="section" id="symptom-2">
<h3><a class="toc-backref" href="#id17">Symptom 2</a><a class="headerlink" href="#symptom-2" title="Permalink to this headline">Â¶</a></h3>
<p>Certain interfaces are in the â€˜suspendedâ€™ state when configuring a
port-channel or virtual port-channel.</p>
</div>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id18">Verification</a><a class="headerlink" href="#id1" title="Permalink to this headline">Â¶</a></h3>
<p>Check the status of the vPC and port-channel using the CLI or GUI.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show vpc</span>
<span class="go">Legend:</span>
<span class="go">                (*) - local vPC is down, forwarding via vPC peer-link</span>

<span class="go">vPC domain id                     : 10</span>
<span class="go">Peer status                       : peer adjacency formed ok</span>
<span class="go">vPC keep-alive status             : Disabled</span>
<span class="go">Configuration consistency status  : success</span>
<span class="go">Per-vlan consistency status       : success</span>
<span class="go">Type-2 inconsistency reason       : Consistency Check Not Performed</span>
<span class="go">vPC role                          : primary</span>
<span class="go">Number of vPCs configured         : 2</span>
<span class="go">Peer Gateway                      : Disabled</span>
<span class="go">Dual-active excluded VLANs        : -</span>
<span class="go">Graceful Consistency Check        : Enabled</span>
<span class="go">Auto-recovery status              : Enabled (timeout = 240 seconds)</span>
<span class="go">Operational Layer3 Peer           : Disabled</span>

<span class="go">vPC Peer-link status</span>
<span class="go">---------------------------------------------------------------------</span>
<span class="go">id   Port   Status Active vlans</span>
<span class="go">--   ----   ------ --------------------------------------------------</span>
<span class="go">1           up     -</span>

<span class="go">vPC status</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">id   Port   Status Consistency Reason                     Active vlans</span>
<span class="go">--   ----   ------ ----------- ------                     ------------</span>
<span class="go">2    Po4    up     success     success                    600-601,634</span>
<span class="go">                                                          ,639,667-66</span>
<span class="go">                                                          8</span>
<span class="go">343  Po1    up     success     success                    700,751</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show port-channel summary</span>
<span class="go">Flags:  D - Down        P - Up in port-channel (members)</span>
<span class="go">        I - Individual  H - Hot-standby (LACP only)</span>
<span class="go">        s - Suspended   r - Module-removed</span>
<span class="go">        S - Switched    R - Routed</span>
<span class="go">        U - Up (port-channel)</span>
<span class="go">        M - Not in use. Min-links not met</span>
<span class="go">--------------------------------------------------------------------------------</span>
<span class="go">Group Port-       Type     Protocol  Member       Ports</span>
<span class="go">      Channel</span>
<span class="go">-------------------------------------------------------------------------------</span>
<span class="go">1     Po1(SU)     Eth      LACP      Eth1/42(P)   Eth1/44(P)</span>
<span class="go">4     Po4(SU)     Eth      LACP      Eth1/27(P)   Eth1/28(s)</span>
</pre></div>
</div>
<p>On the GUI, Fabric -&gt; Inventory -&gt; Pod1 -&gt; leafname -&gt; Interfaces -&gt; vPC
Interfaces -&gt; &lt;vPC Domain ID&gt; -&gt; &lt;vPC ID&gt; -&gt; Faults, would reveal:</p>
<a class="reference internal image-reference" href="_images/14.png"><img alt="_images/14.png" class="align-center" src="_images/14.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Although the vPC is up, links to only one neighbor are members of this
port-channel.</p>
<p>Since the interfaces are in the suspended (s) state, a check of the LACP
interface status would reveal if there are any problems with LACP
communications with the peer. In this example the peer LACP system identifier
are different indicating two different peer devices.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show lacp interface ethernet 1/27 | grep -A 2 Neighbor</span>
<span class="go">Neighbor: 0x113</span>
<span class="go">  MAC Address= 00-0d-ec-b1-a0-3c</span>
<span class="go">  System Identifier=0x8000,00-0d-ec-b1-a0-3c</span>
<span class="go">rtp_leaf1# show lacp interface ethernet 1/28 | grep -A 2 Neighbor</span>
<span class="go">Neighbor: 0x113</span>
<span class="go">  MAC Address= 00-0d-ec-b1-a9-fc</span>
<span class="go">  System Identifier=0x8000,00-0d-ec-b1-a9-fc</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id19">Resolution</a><a class="headerlink" href="#id2" title="Permalink to this headline">Â¶</a></h3>
<p>In this example, rtp_leaf1 and rtp_leaf3 need to form a vPC pair, and they
each need to connect using a dedicated port-channel for each UCS Fabric
Interconnect. When using the vPC wizard or directly configuring virtual
port-channels, unique interface policy groups and interface selectors are
needed to create dedicated port-channels for each peer device, such as UCS
Fabric Interconnect A and Fabric Interconnect B.</p>
<p>Once the needed configuration is done, two independent port-channels are
created.</p>
<div class="section" id="gui">
<h4>GUI:<a class="headerlink" href="#gui" title="Permalink to this headline">Â¶</a></h4>
<p>Fabric -&gt; Access Policies -&gt; Interface Policies -&gt; Policy Groups</p>
<p>Fabric -&gt; Access Policies -&gt; Interface Policies -&gt; Profiles</p>
<a class="reference internal image-reference" href="_images/15.png"><img alt="_images/15.png" class="align-center" src="_images/15.png" style="width: 250px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show port-channel summary</span>
<span class="go">Flags:  D - Down        P - Up in port-channel (members)</span>
<span class="go">        I - Individual  H - Hot-standby (LACP only)</span>
<span class="go">        s - Suspended   r - Module-removed</span>
<span class="go">        S - Switched    R - Routed</span>
<span class="go">        U - Up (port-channel)</span>
<span class="go">        M - Not in use. Min-links not met</span>
<span class="go">-------------------------------------------------------------------------------</span>
<span class="go">Group Port-       Type     Protocol  Member       Ports</span>
<span class="go">      Channel</span>
<span class="go">-------------------------------------------------------------------------------</span>
<span class="go">1     Po1(SU)     Eth      LACP      Eth1/42(P)   Eth1/44(P)</span>
<span class="go">5     Po5(SU)     Eth      LACP      Eth1/27(P)</span>
<span class="go">6     Po6(SD)     Eth      LACP      Eth1/28(P)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id20">Problem Description:</a><a class="headerlink" href="#id3" title="Permalink to this headline">Â¶</a></h2>
<p>There are various use cases, such as migration, where the L2 extension outside
ACI Fabric is needed either through direct EPG extension or through special L2
Out connectivity. During migration scenarios, there is also a need for the
default gateway to be external to the ACI fabric.</p>
<p>Most of the time, the problem represents itself as a reachability problem
between fabric hosted endpoints and external networks. In this example, an
example of Web tier within the Tenant Test is used and the address of
WebServer 10.2.1.11 needs to be reachable from the Nexus 7K, which has been
configured for:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">N7K-1-65-vdc_4# show hsrp brie</span>
<span class="go">P indicates configured to preempt.</span>
<span class="go">|</span>
<span class="go">Interface Grp Prio P State Active addr Standby addr Group addr</span>
<span class="go">Vlan700 700 110 P Active local 10.1.0.2 10.1.0.1 (conf)</span>
<span class="go">Vlan750 750 110 P Active local 10.2.0.2 10.2.0.1 (conf)</span>
<span class="go">Vlan751 751 110 P Active local 10.2.1.2 10.2.1.1 (conf)</span>
</pre></div>
</div>
<p>The WebServer with IP of 10.2.1.11 and BD&#8217;s IP of 10.2.1.254 are unreachable
from the Nexus 7Ks.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">N7K-1-65-vdc_4# ping 10.2.1.254</span>
<span class="go">PING 10.2.1.254 (10.2.1.254): 56 data bytes</span>
<span class="go">Request 0 timed out</span>
<span class="go">Request 1 timed out</span>
<span class="go">Request 2 timed out</span>
<span class="go">Request 3 timed out</span>
<span class="go">Request 4 timed out</span>

<span class="go">--- 10.2.1.254 ping statistics ---</span>
<span class="go">5 packets transmitted, 0 packets received, 100.00% packet loss</span>
<span class="go">N7K-1-65-vdc_4# ping 10.2.1.11</span>
<span class="go">PING 10.2.1.11 (10.2.1.11): 56 data bytes</span>
<span class="go">Request 0 timed out</span>
<span class="go">Request 1 timed out</span>
<span class="go">Request 2 timed out</span>
<span class="go">Request 3 timed out</span>
<span class="go">Request 4 timed out</span>

<span class="go">--- 10.2.1.11 ping statistics ---</span>
<span class="go">5 packets transmitted, 0 packets received, 100.00% packet loss</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>Extending the EPG directly out of the ACI fabric</strong></li>
</ul>
<div class="section" id="symptom-3">
<h3><a class="toc-backref" href="#id21">Symptom 3</a><a class="headerlink" href="#symptom-3" title="Permalink to this headline">Â¶</a></h3>
<p>The Leaf is not getting programmed with the correct VLANs for BridgeDomain and
EPGs.</p>
</div>
<div class="section" id="verification-resolution">
<h3><a class="toc-backref" href="#id22">Verification/Resolution</a><a class="headerlink" href="#verification-resolution" title="Permalink to this headline">Â¶</a></h3>
<p>The reachability problem could be due to many problems, however the most
common problem is that the right leafs are not programmed with the correct
vlans used for BridgeDomain and EPG identification.</p>
<p>BD relationship with the Context:</p>
<p>The context-BD relationship is key for programming the leaf. Without that the
VLANs don&#8217;t get programmed on the leaf as shown below.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show vlan brief</span>

<span class="go"> VLAN Name                             Status    Ports</span>
<span class="go"> ---- -------------------------------- --------- -------------------------------</span>
<span class="go"> 13   infra:default                    active    Eth1/1, Eth1/2, Eth1/5, Eth1/35</span>
<span class="go"> 27   Test:Database                    active    Eth1/27, Eth1/28, Po2, Po3</span>
<span class="go"> 28   Test:CommerceWorkspaceTest:Datab active    Eth1/27, Eth1/28, Po2, Po3</span>
<span class="go">      ase</span>
</pre></div>
</div>
<p>Once the BD is assigned the right context, the BD and EPG Vlans get programmed appropriately.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show vlan brief</span>

<span class="go"> VLAN Name                             Status    Ports</span>
<span class="go"> ---- -------------------------------- --------- -------------------------------</span>
<span class="go"> 13   infra:default                    active    Eth1/1, Eth1/2, Eth1/5, Eth1/35</span>
<span class="go"> 27   Test:Database                    active    Eth1/27, Eth1/28, Po2, Po3</span>
<span class="go"> 28   Test:CommerceWorkspaceTest:Datab active    Eth1/27, Eth1/28, Po2, Po3</span>
<span class="go">      ase</span>
<span class="go"> 37   Test:Web                         active    Eth1/27, Eth1/28, Po2, Po3</span>
<span class="go"> 38   Test:CommerceWorkspaceTest:Web   active    Eth1/27, Eth1/28, Po2, Po3</span>
</pre></div>
</div>
<p>While the VLANs are programmed properly, the Ports on which the VLANs are carried seem to be incomplete. The Po2 and Po3 links to UCS hosting the VMs are shown here, however the links to the N7Ks are not, which leads us to the next possible issue.</p>
<p>Ports not being programmed with EPG encap VLANs:</p>
<p>In this example, VLAN 751 is used to connect to the Nexus 7Ks, and the EPG has been assigned dynamically VLAN 639 within the scope of the VMM domain. The following output confirms while VLAN 639 has been programmed, VLAN 751 is not present on the leaf.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show vlan extended</span>

<span class="go"> VLAN Name                             Status    Ports</span>
<span class="go"> ---- -------------------------------- --------- -------------------------------</span>
<span class="go"> 13   infra:default                    active    Eth1/1, Eth1/2, Eth1/5, Eth1/35</span>
<span class="go"> 27   Test:Database                    active    Eth1/27, Eth1/28, Po2, Po3</span>
<span class="go"> 28   Test:CommerceWorkspaceTest:Datab active    Eth1/27, Eth1/28, Po2, Po3</span>
<span class="go">      ase</span>
<span class="go"> 37   Test:Web                         active    Eth1/27, Eth1/28, Po2, Po3</span>
<span class="go"> 38   Test:CommerceWorkspaceTest:Web   active    Eth1/27, Eth1/28, Po2, Po3</span>

<span class="go"> VLAN Type  Vlan-mode  Encap</span>
<span class="go"> ---- ----- ---------- -------------------------------</span>
<span class="go"> 13   enet  CE         vxlan-16777209, vlan-3500</span>
<span class="go"> 27   enet  CE         vxlan-14680064</span>
<span class="go"> 28   enet  CE         vlan-600</span>
<span class="go"> 37   enet  CE         vxlan-15794150</span>
<span class="go"> 38   enet  CE         vlan-639</span>
</pre></div>
</div>
<p>For this issue to be resolved, the EPG needs to be binded to a port/leaf, and
also the L2Out domain needs to be attached. The L2Out would need to be
associated to a VLAN pool consisting of VLAN 751.</p>
<a class="reference internal image-reference" href="_images/11.PNG"><img alt="_images/11.PNG" class="align-center" src="_images/11.PNG" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Once the configuration is applied, the leafs are programmed to carry all the
relevant L2 constructs: BD, encap VLAN for VMM domain, and encap VLAN for
L2Out. Also, the right interfaces are mapped to the encap VLANs: VLAN-751 on
Po1 to N7Ks and VLAN-639 on Po2, Po3 to both Fabric Interconnects of a UCS
System.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show port-channel summary</span>
<span class="go">Flags:  D - Down        P - Up in port-channel (members)</span>
<span class="go">        I - Individual  H - Hot-standby (LACP only)</span>
<span class="go">        s - Suspended   r - Module-removed</span>
<span class="go">        S - Switched    R - Routed</span>
<span class="go">        U - Up (port-channel)</span>
<span class="go">        M - Not in use. Min-links not met</span>
<span class="go">--------------------------------------------------------------------------------</span>
<span class="go">Group Port-       Type     Protocol  Member Ports</span>
<span class="go">      Channel</span>
<span class="go">--------------------------------------------------------------------------------</span>
<span class="go">1     Po1(SU)     Eth      LACP      Eth1/42(P)   Eth1/44(P)</span>
<span class="go">2     Po2(SU)     Eth      LACP      Eth1/27(P)</span>
<span class="go">3     Po3(SU)     Eth      LACP      Eth1/28(P)</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show vlan extended</span>

<span class="go"> VLAN Name                             Status    Ports</span>
<span class="go"> ---- -------------------------------- --------- -------------------------------</span>
<span class="go"> 13   infra:default                    active    Eth1/1, Eth1/2, Eth1/5, Eth1/35</span>
<span class="go"> 14   Test:CommerceWorkspaceTest:Web   active    Eth1/42, Eth1/44, Po1</span>
<span class="go"> 27   Test:Database                    active    Eth1/27, Eth1/28, Po2, Po3</span>
<span class="go"> 28   Test:CommerceWorkspaceTest:Datab active    Eth1/27, Eth1/28, Po2, Po3</span>
<span class="go">      ase</span>
<span class="go"> 37   Test:Web                         active    Eth1/27, Eth1/28, Eth1/42,</span>
<span class="go">                                                 Eth1/44, Po1, Po2, Po3</span>
<span class="go"> 38   Test:CommerceWorkspaceTest:Web   active    Eth1/27, Eth1/28, Po2, Po3</span>

<span class="go"> VLAN Type  Vlan-mode  Encap</span>
<span class="go"> ---- ----- ---------- -------------------------------</span>
<span class="go"> 13   enet  CE         vxlan-16777209, vlan-3500</span>
<span class="go"> 14   enet  CE         vlan-751</span>
<span class="go"> 27   enet  CE         vxlan-14680064</span>
<span class="go"> 28   enet  CE         vlan-600</span>
<span class="go"> 37   enet  CE         vxlan-15794150</span>
<span class="go"> 38   enet  CE         vlan-639</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show vpc</span>
<span class="go">Legend:</span>
<span class="go">                (*) - local vPC is down, forwarding via vPC peer-link</span>

<span class="go">vPC domain id                     : 10</span>
<span class="go">Peer status                       : peer adjacency formed ok</span>
<span class="go">vPC keep-alive status             : Disabled</span>
<span class="go">Configuration consistency status  : success</span>
<span class="go">Per-vlan consistency status       : success</span>
<span class="go">Type-2 inconsistency reason       : Consistency Check Not Performed</span>
<span class="go">vPC role                          : primary</span>
<span class="go">Number of vPCs configured         : 3</span>
<span class="go">Peer Gateway                      : Disabled</span>
<span class="go">Dual-active excluded VLANs        : -</span>
<span class="go">Graceful Consistency Check        : Enabled</span>
<span class="go">Auto-recovery status              : Enabled (timeout = 240 seconds)</span>
<span class="go">Operational Layer3 Peer           : Disabled</span>

<span class="go">vPC Peer-link status</span>
<span class="go">---------------------------------------------------------------------</span>
<span class="go">id   Port   Status Active vlans</span>
<span class="go">--   ----   ------ --------------------------------------------------</span>
<span class="go">1           up     -</span>

<span class="go">vPC status</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">id   Port   Status Consistency Reason                     Active vlans</span>
<span class="go">--   ----   ------ ----------- ------                     ------------</span>
<span class="go">1    Po2    up     success     success                    600-601,634</span>
<span class="go">                                                          ,639,666-66</span>
<span class="go">                                                          9</span>
<span class="go">343  Po1    up     success     success                    700,751</span>

<span class="go">684  Po3    up     success     success                    600-601,634</span>
<span class="go">                                                          ,639,667-66</span>
<span class="go">                                                          8</span>
<span class="go">rtp_leaf1#</span>
</pre></div>
</div>
<p>Testing now reveals that while N7K can ping the BD address of 10.2.1.254, it
cannot ping the WebServer VM (10.2.1.11).</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">N7K-2-50-N7K2# ping 10.2.1.254</span>
<span class="go">PING 10.2.1.254 (10.2.1.254): 56 data bytes</span>
<span class="go">Request 0 timed out</span>
<span class="go">64 bytes from 10.2.1.254: icmp_seq=1 ttl=56 time=1.656 ms</span>
<span class="go">64 bytes from 10.2.1.254: icmp_seq=2 ttl=56 time=0.568 ms</span>
<span class="go">64 bytes from 10.2.1.254: icmp_seq=3 ttl=56 time=0.826 ms</span>
<span class="go">64 bytes from 10.2.1.254: icmp_seq=4 ttl=56 time=0.428 ms</span>

<span class="go">--- 10.2.1.254 ping statistics ---</span>
<span class="go">5 packets transmitted, 4 packets received, 20.00% packet loss</span>
<span class="go">round-trip min/avg/max = 0.428/0.869/1.656 ms</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="go">N7K-2-50-N7K2# ping 10.2.1.11</span>
<span class="go">PING 10.2.1.11 (10.2.1.11): 56 data bytes</span>
<span class="go">Request 0 timed out</span>
<span class="go">Request 1 timed out</span>
<span class="go">Request 2 timed out</span>
<span class="go">Request 3 timed out</span>
<span class="go">Request 4 timed out</span>

<span class="go">--- 10.2.1.11 ping statistics ---</span>
<span class="go">5 packets transmitted, 0 packets received, 100.00% packet loss</span>
<span class="go">N7K-2-50-N7K2#</span>
</pre></div>
</div>
<p>The scenario described here is Intra-EPG connectivity, where the contracts are
not applied. So this is not related to any filter, which brings us to the next
use case.</p>
</div>
<div class="section" id="symptom-4">
<h3><a class="toc-backref" href="#id23">Symptom 4</a><a class="headerlink" href="#symptom-4" title="Permalink to this headline">Â¶</a></h3>
<p>ACI Fabric is not learning the endpoint IPs on the leafs.</p>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id24">Verification/Resolution</a><a class="headerlink" href="#id4" title="Permalink to this headline">Â¶</a></h3>
<p>Once the leaf is programmed, the endpoints are learned as traffic is received.
The endpoint learning is key, when the BD is in Hardware Proxy mode, so that
the Fabric can efficiently route packets.</p>
<p>Since the N7Ks can ping the BD pervasive gateway address and not the Webserver
IP of 10.2.1.11, the next step is to check the endpoint table.</p>
<p>As seen below, while the N7K addresses (10.2.1.2, 10.2.1.3) are seen, the
webserver IP (10.2.1.11) is missing from the endpoint table.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show endpoint  vrf Test:Test detail</span>
<span class="go">Legend:</span>
<span class="go"> O - peer-attached    H - vtep             a - locally-aged     S - static</span>
<span class="go"> V - vpc-attached     p - peer-aged        L - local            M - span</span>
<span class="go"> s - static-arp       B - bounce</span>
<span class="go">+---------------+---------------+-----------------+--------------+-------------+----------------------+</span>
<span class="go">      VLAN/       Encap           MAC Address       MAC Info/       Interface     Endpoint Group</span>
<span class="go">      Domain      VLAN            IP Address        IP Info                       Info</span>
<span class="go">+---------------+---------------+-----------------+--------------+-------------+----------------------+</span>
<span class="go">Test:Test                               10.1.0.101 L</span>
<span class="go">38/Test:Test            vlan-639    0050.56bb.d508 LV                        po2 Test:CommerceWorkspaceTest:Web</span>
<span class="go">14/Test:Test            vlan-751    0026.f064.0000 LpV                       po1 Test:CommerceWorkspaceTest:Web</span>
<span class="go">14/Test:Test            vlan-751    0000.0c9f.f2ef LpV                       po1 Test:CommerceWorkspaceTest:Web</span>
<span class="go">14                      vlan-751    0026.980a.df44 LpV                       po1 Test:CommerceWorkspaceTest:Web</span>
<span class="go">Test:Test               vlan-751          10.2.1.2 LV</span>
<span class="go">14                      vlan-751    001b.54c2.2644 LV                        po1 Test:CommerceWorkspaceTest:Web</span>
<span class="go">Test:Test               vlan-751          10.2.1.3 LV</span>


<span class="go">+------------------------------------------------------------------------------+</span>
<span class="go">                             Endpoint Summary</span>
<span class="go">+------------------------------------------------------------------------------+</span>
<span class="go">Total number of Local Endpoints     : 6</span>
<span class="go">Total number of Remote Endpoints    : 0</span>
<span class="go">Total number of Peer Endpoints      : 0</span>
<span class="go">Total number of vPC Endpoints       : 5</span>
<span class="go">Total number of non-vPC Endpoints   : 1</span>
<span class="go">Total number of MACs                : 5</span>
<span class="go">Total number of VTEPs               : 0</span>
<span class="go">Total number of Local IPs           : 3</span>
<span class="go">Total number of Remote IPs          : 0</span>
<span class="go">Total number All EPs                : 6</span>
</pre></div>
</div>
<p>Just as mac-addresses are learnt in traditional switching, the endpoints are
learnt by the leaf when the first packet is received. A ping from the VM
triggers this learning and the following output confirm this:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show endpoint  vrf Test:Test detail</span>
<span class="go">Legend:</span>
<span class="go"> O - peer-attached    H - vtep             a - locally-aged     S - static</span>
<span class="go"> V - vpc-attached     p - peer-aged        L - local            M - span</span>
<span class="go"> s - static-arp       B - bounce</span>
<span class="go">+---------------+---------------+-----------------+--------------+-------------+-------------------------+</span>
<span class="go">      VLAN/       Encap           MAC Address       MAC Info/       Interface     Endpoint Group</span>
<span class="go">      Domain      VLAN            IP Address        IP Info                       Info</span>
<span class="go">+---------------+---------------+-----------------+--------------+-------------+-------------------------+</span>
<span class="go">Test:Test                               10.1.0.101 L</span>
<span class="go">38                      vlan-639    0050.56bb.d508 LpV                       po2 Test:CommerceWorkspaceTest:Web</span>
<span class="go">Test:Test               vlan-639         10.2.1.11 LV</span>
<span class="go">14/Test:Test            vlan-751    0026.f064.0000 LpV                       po1 Test:CommerceWorkspaceTest:Web</span>
<span class="go">14/Test:Test            vlan-751    0000.0c9f.f2ef LpV                       po1 Test:CommerceWorkspaceTest:Web</span>
<span class="go">14                      vlan-751    0026.980a.df44 LpV                       po1 Test:CommerceWorkspaceTest:Web</span>
<span class="go">Test:Test               vlan-751          10.2.1.2 LV</span>
<span class="go">14                      vlan-751    001b.54c2.2644 LV                        po1 Test:CommerceWorkspaceTest:Web</span>
<span class="go">Test:Test               vlan-751          10.2.1.3 LV</span>


<span class="go">+------------------------------------------------------------------------------+</span>
<span class="go">                             Endpoint Summary</span>
<span class="go">+------------------------------------------------------------------------------+</span>
<span class="go">Total number of Local Endpoints     : 6</span>
<span class="go">Total number of Remote Endpoints    : 0</span>
<span class="go">Total number of Peer Endpoints      : 0</span>
<span class="go">Total number of vPC Endpoints       : 5</span>
<span class="go">Total number of non-vPC Endpoints   : 1</span>
<span class="go">Total number of MACs                : 5</span>
<span class="go">Total number of VTEPs               : 0</span>
<span class="go">Total number of Local IPs           : 4</span>
<span class="go">Total number of Remote IPs          : 0</span>
<span class="go">Total number All EPs                : 6</span>
</pre></div>
</div>
<p>Once the endpoint is learned, the ping is successful from the N7K to the Webserver IP of 10.2.1.11</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">N7K-1-65-vdc_4# ping 10.2.1.11</span>
<span class="go">PING 10.2.1.11 (10.2.1.11): 56 data bytes</span>
<span class="go">64 bytes from 10.2.1.11: icmp_seq=0 ttl=127 time=1.379 ms</span>
<span class="go">64 bytes from 10.2.1.11: icmp_seq=1 ttl=127 time=1.08 ms</span>
<span class="go">64 bytes from 10.2.1.11: icmp_seq=2 ttl=127 time=0.498 ms</span>
<span class="go">64 bytes from 10.2.1.11: icmp_seq=3 ttl=127 time=0.479 ms</span>
<span class="go">64 bytes from 10.2.1.11: icmp_seq=4 ttl=127 time=0.577 ms</span>

<span class="go">--- 10.2.1.11 ping statistics ---</span>
<span class="go">5 packets transmitted, 5 packets received, 0.00% packet loss</span>
<span class="go">round-trip min/avg/max = 0.479/0.802/1.379 ms</span>
<span class="go">N7K-1-65-vdc_4#</span>
</pre></div>
</div>
<p>This issue is also seen with the N7K HSRP address as well, since N7K does not
normally source packets from the HSRP address. In the above tables, the HSRP
IP (10.2.1.1) is missing from the endpoint table.</p>
<p>Forcing N7K to source the packet from the HSRP address populates the endpoint
table.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">N7K-1-65-vdc_4# ping 10.2.1.254 source 10.2.1.1</span>
<span class="go">PING 10.2.1.254 (10.2.1.254) from 10.2.1.1: 56 data bytes</span>
<span class="go">Request 0 timed out</span>
<span class="go">64 bytes from 10.2.1.254: icmp_seq=1 ttl=57 time=1.472 ms</span>
<span class="go">64 bytes from 10.2.1.254: icmp_seq=2 ttl=57 time=1.062 ms</span>
<span class="go">64 bytes from 10.2.1.254: icmp_seq=3 ttl=57 time=1.097 ms</span>
<span class="go">64 bytes from 10.2.1.254: icmp_seq=4 ttl=57 time=1.232 ms</span>

<span class="go">--- 10.2.1.254 ping statistics ---</span>
<span class="go">5 packets transmitted, 4 packets received, 20.00% packet loss</span>
<span class="go">round-trip min/avg/max = 1.062/1.215/1.472 ms</span>
<span class="go">N7K-1-65-vdc_4#</span>
</pre></div>
</div>
<p>This is one of the reason, when the default gateway is outside the fabric, the
Fabric BD mode should be enabled for flooding and NOT Hardware Proxy.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show endpoint  vrf Test:Test detail</span>
<span class="go">Legend:</span>
<span class="go"> O - peer-attached    H - vtep             a - locally-aged     S - static</span>
<span class="go"> V - vpc-attached     p - peer-aged        L - local            M - span</span>
<span class="go"> s - static-arp       B - bounce</span>
<span class="go">+---------------+---------------+-----------------+--------------+-------------+----------------------+</span>
<span class="go">      VLAN/       Encap           MAC Address       MAC Info/       Interface     Endpoint Group</span>
<span class="go">      Domain      VLAN            IP Address        IP Info                       Info</span>
<span class="go">+---------------+---------------+-----------------+--------------+-------------+----------------------+</span>
<span class="go">Test:Test                               10.1.0.101 L</span>
<span class="go">38                      vlan-639    0050.56bb.d508 LV                        po2 Test:CommerceWorkspaceTest:Web</span>
<span class="go">Test:Test               vlan-639         10.2.1.11 LV</span>
<span class="go">14/Test:Test            vlan-751    0026.f064.0000 LpV                       po1 Test:CommerceWorkspaceTest:Web</span>
<span class="go">14/Test:Test            vlan-751    0000.0c9f.f2ef LpV                       po1 Test:CommerceWorkspaceTest:Web</span>
<span class="go">14                      vlan-751    0026.980a.df44 LpV                       po1 Test:CommerceWorkspaceTest:Web</span>
<span class="go">Test:Test               vlan-751          10.2.1.2 LV</span>
<span class="go">14                      vlan-751    001b.54c2.2644 LpV                       po1 Test:CommerceWorkspaceTest:Web</span>
<span class="go">Test:Test               vlan-751          10.2.1.3 LV</span>
<span class="go">Test:Test               vlan-751          10.2.1.1 LV</span>


<span class="go">+------------------------------------------------------------------------------+</span>
<span class="go">                             Endpoint Summary</span>
<span class="go">+------------------------------------------------------------------------------+</span>
<span class="go">Total number of Local Endpoints     : 6</span>
<span class="go">Total number of Remote Endpoints    : 0</span>
<span class="go">Total number of Peer Endpoints      : 0</span>
<span class="go">Total number of vPC Endpoints       : 5</span>
<span class="go">Total number of non-vPC Endpoints   : 1</span>
<span class="go">Total number of MACs                : 5</span>
<span class="go">Total number of VTEPs               : 0</span>
<span class="go">Total number of Local IPs           : 5</span>
<span class="go">Total number of Remote IPs          : 0</span>
<span class="go">Total number All EPs                : 6</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="go">N7K-1-65-vdc_4# ping 10.2.1.11 source 10.2.1.1</span>
<span class="go">PING 10.2.1.11 (10.2.1.11) from 10.2.1.1: 56 data bytes</span>
<span class="go">64 bytes from 10.2.1.11: icmp_seq=0 ttl=127 time=1.276 ms</span>
<span class="go">64 bytes from 10.2.1.11: icmp_seq=1 ttl=127 time=0.751 ms</span>
<span class="go">64 bytes from 10.2.1.11: icmp_seq=2 ttl=127 time=0.752 ms</span>
<span class="go">64 bytes from 10.2.1.11: icmp_seq=3 ttl=127 time=0.807 ms</span>
<span class="go">64 bytes from 10.2.1.11: icmp_seq=4 ttl=127 time=0.741 ms</span>

<span class="go">--- 10.2.1.11 ping statistics ---</span>
<span class="go">5 packets transmitted, 5 packets received, 0.00% packet loss</span>
<span class="go">round-trip min/avg/max = 0.741/0.865/1.276 ms</span>
<span class="go">N7K-1-65-vdc_4#</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id25">Problem Description</a><a class="headerlink" href="#id5" title="Permalink to this headline">Â¶</a></h2>
<p><strong>Extending bridged domain using external bridged network:</strong></p>
<p>In this scenario, Layer 2 extension is achieved using a unique external EPG so
as to address spanning tree interoperability when integrating/extending with
external Layer 2 networks inside the ACI fabric.</p>
<p>In this setup, the Web EPG is not directly associated with L2Out interfaces
towards the N7K. Instead, Web EPG is associated to BD Web, which is then
extended using external bridged connectivity named L2Out, with the external
networks identified to be allowed to communicate with the Web tier.</p>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id26">Symptom 1</a><a class="headerlink" href="#id6" title="Permalink to this headline">Â¶</a></h3>
<p>The Leaf is not getting programmed with the correct VLANs for BridgeDomain and
EPGs.</p>
</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id27">Verification</a><a class="headerlink" href="#id7" title="Permalink to this headline">Â¶</a></h3>
<p>As with the previous scenario with direct EPG extension outside the fabric,
programming the leafs needs to happen before the endpoints are learned by the
leafs. Mismatch in configuration is the most common scenario seen when
defining the extended bridged network.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show vlan extended</span>

<span class="go">VLAN Name                             Status    Ports</span>
<span class="go">---- -------------------------------- --------- -------------------------------</span>
<span class="go">13   infra:default                    active    Eth1/1, Eth1/2, Eth1/5, Eth1/35</span>
<span class="go">27   Test:Database                    active    Eth1/27, Eth1/28, Po2, Po3</span>
<span class="go">28   Test:CommerceWorkspaceTest:Datab active    Eth1/27, Eth1/28, Po2, Po3</span>
<span class="go">     ase</span>
<span class="go">37   Test:Web                         active    Eth1/27, Eth1/28, Eth1/42,</span>
<span class="go">                                                Eth1/44, Po1, Po2, Po3</span>
<span class="go">38   Test:CommerceWorkspaceTest:Web   active    Eth1/27, Eth1/28, Po2, Po3</span>
<span class="go">68   --                               active    Eth1/42, Eth1/44, Po1</span>

<span class="go">VLAN Type  Vlan-mode  Encap</span>
<span class="go">---- ----- ---------- -------------------------------</span>
<span class="go">13   enet  CE         vxlan-16777209, vlan-3500</span>
<span class="go">27   enet  CE         vxlan-14680064</span>
<span class="go">28   enet  CE         vlan-600</span>
<span class="go">37   enet  CE         vxlan-15794150</span>
<span class="go">38   enet  CE         vlan-639</span>
<span class="go">68   enet  CE         vlan-750</span>
</pre></div>
</div>
<p>Since N7Ks are expecting VLAN-751 but the L2Out is configured with VLAN-750,
the Layer 2 domains are not extended correctly.</p>
<a class="reference internal image-reference" href="_images/12.PNG"><img alt="_images/12.PNG" class="align-center" src="_images/12.PNG" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#id28">Resolution</a><a class="headerlink" href="#id8" title="Permalink to this headline">Â¶</a></h3>
<p>Changing it to VLAN-751, makes the N7K ping the BD address of 10.2.1.254, but
not the WebServer 10.1.2.11. This is due to the fact that external network are
identified as an EPG L2Out and contracts are needed to make communication
happen between any two EPGs.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show vlan extended</span>
<span class="go"> VLAN Name                             Status    Ports</span>
<span class="go"> ---- -------------------------------- --------- -------------------------------</span>
<span class="go"> 13   infra:default                    active    Eth1/1, Eth1/2, Eth1/5, Eth1/35</span>
<span class="go"> 27   Test:Database                    active    Eth1/27, Eth1/28, Po2, Po3</span>
<span class="go"> 28   Test:CommerceWorkspaceTest:Datab active    Eth1/27, Eth1/28, Po2, Po3</span>
<span class="go">      ase</span>
<span class="go"> 37   Test:Web                         active    Eth1/27, Eth1/28, Eth1/42,</span>
<span class="go">                                                 Eth1/44, Po1, Po2, Po3</span>
<span class="go"> 38   Test:CommerceWorkspaceTest:Web   active    Eth1/27, Eth1/28, Po2, Po3</span>
<span class="go"> 69   --                               active    Eth1/42, Eth1/44, Po1</span>

<span class="go"> VLAN Type  Vlan-mode  Encap</span>
<span class="go"> ---- ----- ---------- -------------------------------</span>
<span class="go"> 13   enet  CE         vxlan-16777209, vlan-3500</span>
<span class="go"> 27   enet  CE         vxlan-14680064</span>
<span class="go"> 28   enet  CE         vlan-600</span>
<span class="go"> 37   enet  CE         vxlan-15794150</span>
<span class="go"> 38   enet  CE         vlan-639</span>
<span class="go"> 69   enet  CE         vlan-751</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="go">N7K-1-65-vdc_4# ping 10.2.1.254</span>
<span class="go">PING 10.2.1.254 (10.2.1.254): 56 data bytes</span>
<span class="go">64 bytes from 10.2.1.254: icmp_seq=0 ttl=56 time=1.068 ms</span>
<span class="go">64 bytes from 10.2.1.254: icmp_seq=1 ttl=56 time=0.753 ms</span>
<span class="go">64 bytes from 10.2.1.254: icmp_seq=2 ttl=56 time=0.708 ms</span>
<span class="go">64 bytes from 10.2.1.254: icmp_seq=3 ttl=56 time=0.731 ms</span>
<span class="go">64 bytes from 10.2.1.254: icmp_seq=4 ttl=56 time=0.699 ms</span>

<span class="go">--- 10.2.1.254 ping statistics ---</span>
<span class="go">5 packets transmitted, 5 packets received, 0.00% packet loss</span>
<span class="go">round-trip min/avg/max = 0.699/0.791/1.068 ms</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="go">N7K-1-65-vdc_4# ping 10.2.1.11</span>
<span class="go">PING 10.2.1.11 (10.2.1.11): 56 data bytes</span>
<span class="go">Request 0 timed out</span>
<span class="go">Request 1 timed out</span>
<span class="go">Request 2 timed out</span>
<span class="go">Request 3 timed out</span>
<span class="go">Request 4 timed out</span>

<span class="go">--- 10.2.1.11 ping statistics ---</span>
<span class="go">5 packets transmitted, 0 packets received, 100.00% packet loss</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h3><a class="toc-backref" href="#id29">Symptom 2</a><a class="headerlink" href="#id9" title="Permalink to this headline">Â¶</a></h3>
<p>The Leaf is programmed with correct VLANs and Interfaces as expected, but the
servers are unreachable from the outside L2 network.</p>
</div>
<div class="section" id="id10">
<h3><a class="toc-backref" href="#id30">Verification</a><a class="headerlink" href="#id10" title="Permalink to this headline">Â¶</a></h3>
<p>The presence of contracts between the Web EPG and L2Out EPG need to be checked
to confirm reachability of Webserver from N7K. The PcTag of Web EPG is found
from Visore to be 49153.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show zoning-rule | grep 49153</span>

<span class="go">rtp_leaf1#</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h3><a class="toc-backref" href="#id31">Resolution</a><a class="headerlink" href="#id11" title="Permalink to this headline">Â¶</a></h3>
<p>After configuring contracts between the WebEPG and L2Out EPG, the command
output shows as below:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show zoning-rule | grep 49153</span>
<span class="go">5352            49153           16386           default         enabled         2883584         permit</span>
<span class="go">5353            16386           49153           default         enabled         2883584         permit</span>
</pre></div>
</div>
<p>Once the contracts are defined, the pings from N7K are successful. The
endpoints still are learnt as they send traffic, so the issues highlighted in
the previous <strong>&#8216;Symptoms when extending the EPG directly out of the ACI fabric:
Endpoint not in the database&#8217;</strong> section is applicable even in this scenario.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">N7K-1-65-vdc_4# ping 10.2.1.11</span>
<span class="go">PING 10.2.1.11 (10.2.1.11): 56 data bytes</span>
<span class="go">64 bytes from 10.2.1.11: icmp_seq=0 ttl=127 time=1.676 ms</span>
<span class="go">64 bytes from 10.2.1.11: icmp_seq=1 ttl=127 time=0.689 ms</span>
<span class="go">64 bytes from 10.2.1.11: icmp_seq=2 ttl=127 time=0.626 ms</span>
<span class="go">64 bytes from 10.2.1.11: icmp_seq=3 ttl=127 time=0.75 ms</span>
<span class="go">64 bytes from 10.2.1.11: icmp_seq=4 ttl=127 time=0.797 ms</span>

<span class="go">--- 10.2.1.11 ping statistics ---</span>
<span class="go">5 packets transmitted, 5 packets received, 0.00% packet loss</span>
<span class="go">round-trip min/avg/max = 0.626/0.907/1.676 ms</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="routed2ext.html" class="btn btn-neutral float-right" title="Routed Connectivity to External Networks">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pol_cntr.html" class="btn btn-neutral" title="Policies and Contracts"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Andres Vega, Bryan Deaver, Jerry Ye, Kannan Ponnuswamy, Loy Evans, Mike Timm, Paul Lesiak and Paul Raytick.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60418502-1', 'auto');
    ga('send', 'pageview');

  </script>
   

</body>
</html>


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Fabric Initialization &mdash; ACI Troubleshooting Book 0.0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="ACI Troubleshooting Book 0.0.1 documentation" href="index.html"/>
        <link rel="next" title="APIC High Availablity and Clustering" href="apic.html"/>
        <link rel="prev" title="Initial Hardware Bringup" href="hw_bringup.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> ACI Troubleshooting Book</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="preface.html#authors-and-contributors">Authors and Contributors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#authors">Authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#distinguished-contributors">Distinguished Contributors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#dedications">Dedications</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#acknowledgments">Acknowledgments</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#book-writing-methodology">Book Writing Methodology</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#who-should-read-this-book">Who Should Read This Book?</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#organization-of-this-book">Organization of this Book</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="aci.html">Application Centric Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="aci_policy_model.html">ACI Policy Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#abstraction-model">Abstraction Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#everything-is-an-object">Everything is an Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#relevant-objects-and-relationships">Relevant Objects and Relationships</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#hierarchical-aci-object-model-and-the-infrastructure">Hierarchical ACI Object Model and the Infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#infrastructure-as-objects">Infrastructure as Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#build-object-use-object-to-build-policy-reuse-policy">Build object, use object to build policy, reuse policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#rest-api-just-exposes-the-object-model">REST API just exposes the object model</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#logical-model-resolved-model-concrete-model">Logical model, Resolved model, concrete model</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#formed-and-unformed-relationships">Formed and Unformed Relationships</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#declarative-end-state-and-promise-theory">Declarative End State and Promise Theory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Troubleshooting Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tools.html#apic-access-methods">APIC Access Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#programmatic-configuration-python">Programmatic Configuration (Python)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#fabric-node-access-methods">Fabric Node Access Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#exporting-information-from-the-fabric">Exporting information from the Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#external-data-collection-syslog-snmp-call-home">External Data Collection – Syslog, SNMP, Call-Home</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#health-scores">Health Scores</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#atomic-counters">Atomic Counters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ts_methodology.html">Troubleshooting Methodology</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ts_methodology.html#overall-methodology">Overall Methodology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="topology.html">Sample Reference Topology</a><ul>
<li class="toctree-l2"><a class="reference internal" href="topology.html#physical-fabric-topology">Physical Fabric Topology</a></li>
<li class="toctree-l2"><a class="reference internal" href="topology.html#logical-application-topology">Logical Application Topology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#naming-conventions">Naming Conventions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hw_bringup.html">Initial Hardware Bringup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hw_bringup.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_bringup.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_bringup.html#id2">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Fabric Initialization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fabric-verification">Fabric Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apic.html">Application Policy Infrastructure Controller (APIC) High Availability and Clustering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="apic.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#cluster-formation">Cluster Formation</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#majority-and-minority-handling-clustering-split-brains">Majority and Minority - Handling Clustering Split Brains</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id1">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id4">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id6">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id9">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id12">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id15">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="firmware.html">Firmware and Image Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#id1">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#id5">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="health.html">Faults / Health Scores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="health.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="health.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="health.html#id1">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rest.html">REST Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="rest.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="rest.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mgmt_tn.html">Management Tenant</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mgmt_tn.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="mgmt_tn.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="mgmt_tn.html#id1">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common Network Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="common.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="common.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="common.html#id15">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="unicast.html">Unicast Data Plane Forwarding and Reachability</a><ul>
<li class="toctree-l2"><a class="reference internal" href="unicast.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicast.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicast.html#id1">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pol_cntr.html">Policies and Contracts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pol_cntr.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="pol_cntr.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bridged2ext.html">Bridged Connectivity to External Networks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="bridged2ext.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridged2ext.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridged2ext.html#id3">Problem Description:</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridged2ext.html#id5">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="routed2ext.html">Routed Connectivity to External Networks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#fabric-verification">Fabric Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#problem-description">Problem description</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#id1">Problem description</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#id3">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vmm_ucs.html">Virtual Machine Manager and UCS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#id2">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#id6">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#id9">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="l4l7.html">L4-L7 Service Insertion</a><ul>
<li class="toctree-l2"><a class="reference internal" href="l4l7.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="l4l7.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fn_crash_ts.html">ACI Fabric Node and Process Crash Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fn_crash_ts.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="fn_crash_ts.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apic_crash_ts.html">APIC Process Crash Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="apic_crash_ts.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic_crash_ts.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#overview">Overview</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ACI Troubleshooting Book</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div></div>
          <div role="main" class="document">
            
  <div class="section" id="fabric-initialization">
<h1>Fabric Initialization<a class="headerlink" href="#fabric-initialization" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id5">Overview</a></li>
<li><a class="reference internal" href="#fabric-verification" id="id6">Fabric Verification</a></li>
<li><a class="reference internal" href="#problem-description" id="id7">Problem Description</a><ul>
<li><a class="reference internal" href="#symptom-1" id="id8">Symptom 1</a></li>
<li><a class="reference internal" href="#verification" id="id9">Verification</a></li>
<li><a class="reference internal" href="#symptom-2" id="id10">Symptom 2</a></li>
<li><a class="reference internal" href="#id1" id="id11">Verification</a></li>
<li><a class="reference internal" href="#resolution" id="id12">Resolution</a></li>
<li><a class="reference internal" href="#symptom-3" id="id13">Symptom 3</a></li>
<li><a class="reference internal" href="#id2" id="id14">Resolution</a></li>
<li><a class="reference internal" href="#symptom-4" id="id15">Symptom 4</a></li>
<li><a class="reference internal" href="#id3" id="id16">Verification</a></li>
<li><a class="reference internal" href="#id4" id="id17">Resolution</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id5">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This chapter covers the discovery process for an ACI fabric, beginning with an
overview of the actions that happen and the verification steps used to confirm
that a functioning fabric exists. The displays have been captured from our
reference topology working fabric and can be used as an aid in troubleshooting
issues where fabric nodes fail to join the fabric.</p>
<p>In this discovery process, a fabric node is considered active when the APIC
and node can exchange heartbeats through the Intra-Fabric Messaging (IFM)
process. The IFM process is also used by the APIC to push policy to the fabric
leaf nodes.</p>
<p>Fabric discovery happens in three stages. The leaf node directly connected to
the APIC is discovered in the first stage. The second stage of discovery
brings in the spines connected to that initial seed leaf. Then the third stage
processes the discovery of the other leaf nodes and APICs in the cluster.</p>
<p>The diagram below illustrates the discovery process for switches that are
directly connected to the APIC. Coverage of specific verification for other
parts of the process will be presented later in the chapter.</p>
<p>The steps are:</p>
<ul class="simple">
<li>Link Layer Discovery Protocol (LLDP) Neighbor Discovery</li>
<li>Tunnel End Point (TEP) IP address assignment to the node</li>
<li>Node software upgraded if necessary</li>
<li>Policy Element IFM Setup</li>
</ul>
<a class="reference internal image-reference" href="_images/APIC-Switch.jpg"><img alt="_images/APIC-Switch.jpg" class="align-center" src="_images/APIC-Switch.jpg" style="width: 750px;" /></a>
<p>Node status may fluctuate between several states during the fabric
registration process. The states are shown in the Fabric Node Vector table.
The APIC CLI command to show the Fabric Node Vector table <strong>acidiag fnvread</strong>
and sample output will be shown further down in this section.Below is a
description of each state.</p>
<p>States and descriptions:</p>
<ul class="simple">
<li>Unknown – Node discovered but no Node ID policy configured</li>
<li>Undiscovered – Node ID configured but not yet discovered</li>
<li>Discovering – Node discovered but IP not yet assigned</li>
<li>Unsupported – Node is not a supported model</li>
<li>Disabled – Node has been decommissioned</li>
<li>Inactive – No IP connectivity</li>
<li>Active – Node is active</li>
</ul>
<p>During fabric registration and initialization a port might transition to an
&#8220;out-of-service&#8221; state. Once a port has transitioned to an out-of-service
status, only DHCP and CDP/LLDP protocols are allowed to be transmitted. Below
is a description of each out-of-service issue that may be encountered:</p>
<ul class="simple">
<li>fabric-domain-mismatch – Adjacent node belongs to a different fabric</li>
<li>ctrlr-uuid-mismatch – APIC UUID mismatch (duplicate APIC ID)</li>
<li>wiring-mismatch – Invalid connection (Leaf to Leaf, Spine to non-leaf, Leaf
fabric port to non-spine etc.)</li>
<li>adjaceny-not-detected –  No LLDP adjacency on fabric port</li>
</ul>
<p>Ports can go out-of-service due to wiring issues. Wiring Issues get reported
through the lldpIf object information on this object can be browsed at the
following object location in the MIT: /mit/sys/lldp/inst/if-[eth1/1]/summary.</p>
</div>
<div class="section" id="fabric-verification">
<h2><a class="toc-backref" href="#id6">Fabric Verification</a><a class="headerlink" href="#fabric-verification" title="Permalink to this headline">¶</a></h2>
<p>This section illustrates some displays from the reference topology configured
and in full working order.</p>
<a class="reference internal image-reference" href="_images/topo.png"><img alt="_images/topo.png" class="align-center" src="_images/topo.png" style="width: 750px;" /></a>
<p>The first step is to verify LLDP neighborships information has been exchanged.
To verify LLDP information exchange, the command <strong>show lldp neighbors</strong> can be
used. This command can be run on the APIC and executed on the nodes, or it can
be run directly on the fabric nodes. The APIC runs Linux using a bash-based
shell, that is not sensitive to the question mark, as is typical for IOS or
NX-OS shells. In order to see all the command options, the APIC requires the
entry of a special control sequence sent by pressing the escape key twice.
This double escape sequence is the equivalent of the NXOS/IOS contextual help
function triggered when the question mark &#8221;?&#8221; is typed in the CLI. For
example, the output below shows the result of typing <strong>show lldp neighbors</strong>
&lt;esc&gt; &lt;esc&gt;:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic1:~&gt; &lt;b&gt;show lldp neighbors&lt;/b&gt;</span>
<span class="go"> node        Fabric node</span>
<span class="go"> rtp_leaf1   Specify Fabric Node Name</span>
<span class="go"> rtp_leaf2   Specify Fabric Node Name</span>
<span class="go"> rtp_leaf3   Specify Fabric Node Name</span>
<span class="go"> rtp_spine1  Specify Fabric Node Name</span>
<span class="go"> rtp_spine2  Specify Fabric Node Name</span>
</pre></div>
</div>
<p>Based on the option provided in the contextual help output above, now extending
the command to  show lldp neighbors node produces the following output:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic1:~&gt; show lldp neighbors node</span>
<span class="go"> 101  Specify Fabric Node id</span>
<span class="go"> 102  Specify Fabric Node id</span>
<span class="go"> 103  Specify Fabric Node id</span>
<span class="go"> 201  Specify Fabric Node id</span>
<span class="go"> 202  Specify Fabric Node id</span>
</pre></div>
</div>
<p>Executing the command <strong>show lldp neighbors rtp_leaf1</strong> in the APIC CLI
displays all the LLDP Neighbors adjacent to &#8220;rtp_leaf1&#8221;. The output shows that
this leaf is connected to two different APICs and two spines.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic1:~&gt; show lldp neighbors rtp_leaf1</span>
<span class="gp">#</span> Executing <span class="nb">command</span>: <span class="s1">&#39;cat /aci/fabric/inventory/pod-1/rtp_leaf1/protocols/lldp/neighbors/summary&#39;</span>
<span class="go">neighbors:</span>
<span class="go">device-id       local-interface  hold-time  capability     port-id</span>
<span class="go">--------------  ---------------  ---------  -------------  -----------------</span>
<span class="go">RTP_Apic1       eth1/1           120                       90:e2:ba:4b:fc:78</span>
<span class="go">RTP_Apic2       eth1/2           120                       90:e2:ba:5a:9f:30</span>
<span class="go">rtp_spine1      eth1/49          120        bridge,router  Eth3/1</span>
<span class="go">rtp_spine2      eth1/50          120        bridge,router  Eth4/1</span>
</pre></div>
</div>
<p>This command may also be run directly on the leaf as shown below:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show lldp neighbors</span>
<span class="go">Capability codes:</span>
<span class="go">  (R) Router, (B) Bridge, (T) Telephone, (C) DOCSIS Cable Device</span>
<span class="go">  (W) WLAN Access Point, (P) Repeater, (S) Station, (O) Other</span>
<span class="go">Device ID            Local Intf      Hold-time  Capability  Port ID</span>
<span class="go">RTP_Apic1             Eth1/1          120                    90:e2:ba:4b:fc:78</span>
<span class="go">RTP_Apic2             Eth1/2          120                    90:e2:ba:5a:9f:30</span>
<span class="go">rtp_spine1            Eth1/49         120        BR          Eth3/1</span>
<span class="go">rtp_spine2            Eth1/50         120        BR          Eth4/1</span>
</pre></div>
</div>
<p>When the command <strong>acidiag fnvread</strong> is run in the APIC CLI, it can be used to
verify the Fabric Node Vector (FNV) that is exchanged using LLDP. This is the
quickest way to determine if each node is active, and a TEP address has been
assigned.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic1:~&gt; acidiag fnvread</span>

<span class="go">     ID             Name    Serial Number         IP Address    Role        State    LastUpdMsgId</span>
<span class="go">-------------------------------------------------------------------------------------------------</span>
<span class="go">    101        rtp_leaf1      SAL1819SAN6   172.16.136.95/32    leaf        active   0</span>
<span class="go">    102        rtp_leaf2      SAL172682S0   172.16.136.91/32    leaf        active   0</span>
<span class="go">    103        rtp_leaf3      SAL1802KLJF   172.16.136.92/32    leaf        active   0</span>
<span class="go">    201       rtp_spine1      FGE173400H2   172.16.136.93/32   spine        active   0</span>
<span class="go">    202       rtp_spine2      FGE173400H7   172.16.136.94/32   spine        active   0</span>

<span class="go">Total 5 nodes</span>
</pre></div>
</div>
<p>When the command <strong>acidiag avread</strong> is run in the APIC CLI, it can be used to
verify the Appliance Vector (AV) that is exchanged using LLDP. This is the
best way to determine the APICs are all part of one clustered fabric. This
command also helps to verify that the TEP address is assigned, the appliance
is commissioned, registered, and active, and the health is equal to 255 which
signifies the appliance is &#8220;fully fit&#8221;.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic1:~&gt; acidiag avread</span>
<span class="go">Local appliance ID=1 ADDRESS=172.16.0.1 TEP ADDRESS=172.16.0.0/16 CHASSIS_ID=a5945f3c-53c8-11e4-bde2-ebe6f6cfeb58</span>
<span class="go">Cluster of 3 lm(t):1(2014-10-14T20:04:46.691+00:00) appliances (out of targeted 3 lm(t):3(2014-10-14T20:05:22.567+00:00)) with FABRIC_DOMAIN name=RTP_Fabric set to version=1.0(1k) lm(t):3(2014-10-14T20:05:23.486+00:00)</span>
<span class="go">    appliance id=1 last mutated at 2014-10-14T17:36:51.734+00:00 address=172.16.0.1 tep address=172.16.0.0/16 oob address=10.122.254.211/24 version=1.0(1k) lm(t):1(2014-10-14T20:12:28.291+00:00) chassisId=a5945f3c-53c8-11e4-bde2-ebe6f6cfeb58 lm(t):1(2014-10-14T20:12:28.291+00:00) commissioned=1 registered=1 active=yes(zeroTime) health=(applnc:255 lm(t):1(2014-10-14T20:13:30.052+00:00) svc&#39;s)</span>
<span class="go">    appliance id=2 last mutated at 2014-10-14T19:55:24.356+00:00 address=172.16.0.2 tep address=172.16.0.0/16 oob address=10.122.254.212/24 version=1.0(1k) lm(t):2(2014-10-14T20:12:28.571+00:00) chassisId=f56e0130-53db-11e4-ba9f-83158a2b73fa lm(t):2(2014-10-14T20:12:28.571+00:00) commissioned=1 registered=1 active=yes(2014-10-14T19:55:24.357+00:00) health=(applnc:255 lm(t):2(2014-10-14T20:13:30.084+00:00) svc&#39;s)</span>
<span class="go">    appliance id=3 last mutated at 2014-10-14T20:04:46.922+00:00 address=172.16.0.3 tep address=172.16.0.0/16 oob address=10.122.254.213/24 version=1.0(1k) lm(t):3(2014-10-14T20:12:28.493+00:00) chassisId=2e7f7a70-53dd-11e4-a8f2-5d5876c67adc lm(t):3(2014-10-14T20:12:28.493+00:00) commissioned=1 registered=1 active=yes(2014-10-14T20:12:28.179+00:00) health=(applnc:255 lm(t):3(2014-10-14T20:13:29.757+00:00) svc&#39;s)</span>
<span class="go">clusterTime=&lt;diff=0 common=2014-10-14T20:24:47.810+00:00 local=2014-10-14T20:24:47.810+00:00 pF=&lt;displForm=0 offsSt=0 offsVlu=0 lm(t):3(2014-10-14T20:05:23.096+00:00)&gt;&gt;</span>
</pre></div>
</div>
<p>This same information can also be verified using the ACI GUI. The capture
below shows the APIC cluster health screen.</p>
<a class="reference internal image-reference" href="_images/cluster.png"><img alt="_images/cluster.png" class="align-center" src="_images/cluster.png" style="width: 750px;" /></a>
<p>The capture below displays the overall fabric topology. When fully discovered,
each node should be visible under the Pod1 folder.</p>
<a class="reference internal image-reference" href="_images/fab-health.png"><img alt="_images/fab-health.png" class="align-center" src="_images/fab-health.png" style="width: 750px;" /></a>
</div>
<div class="section" id="problem-description">
<h2><a class="toc-backref" href="#id7">Problem Description</a><a class="headerlink" href="#problem-description" title="Permalink to this headline">¶</a></h2>
<p>During fabric discovery, issues may be encountered when a leaf or spine does
not join the ACI fabric due to issues that were mentioned in the overview
section of this chapter.</p>
<div class="section" id="symptom-1">
<h3><a class="toc-backref" href="#id8">Symptom 1</a><a class="headerlink" href="#symptom-1" title="Permalink to this headline">¶</a></h3>
<p>The leaf or spine does not show up in fabric membership GUI.</p>
</div>
<div class="section" id="verification">
<h3><a class="toc-backref" href="#id9">Verification</a><a class="headerlink" href="#verification" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Check the power status of switches and ensure they are powered on. Use the
locator LED to identify if each switch is in a healthy state.</li>
<li>Check the cabling between switches. Example:  Leaf should only be connected
to Spine and APIC. Spine should only be connected to Leaves.</li>
<li>Use console cables to access the device, verify if the device is in loader&gt;
prompt or (none) prompt.<ol class="arabic">
<li>When using the console connection, if the device displays the loader&gt;
prompt, the switch is in a state where it did not load the ACI switch
software image. Please refer to the ‘ACI Fabric Node and Process Crash
Troubleshooting&#8217; chapter of this document that explains how to recover
from the loader prompt.</li>
<li>When using the console connection, if the device displays the
(none) login: prompt, enter “admin” then hit the Enter key to access
the CLI. The following message should appear on the screen:</li>
</ol>
</li>
</ol>
<div class="highlight-console"><div class="highlight"><pre><span class="go">User Access Verification</span>

<span class="go">(none) login: admin</span>
<span class="go">********************************************************************************</span>
<span class="go">     Fabric discovery in progress, show commands are not fully functional</span>
<span class="go">     Logout and Login after discovery to continue to use show commands.</span>
<span class="go">********************************************************************************</span>
<span class="gp">(none)#</span>
</pre></div>
</div>
<p>Use the command show lldp neighbor to verify if the Leaf is connected to the
spine or APIC. If this is a spine, it should be connected to the leaves.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">(none)#</span> show lldp neighbor
<span class="go">Capability codes:</span>
<span class="go">  (R) Router, (B) Bridge, (T) Telephone, (C) DOCSIS Cable Device</span>
<span class="go">  (W) WLAN Access Point, (P) Repeater, (S) Station, (O) Other</span>
<span class="go">Device ID            Local Intf      Hold-time  Capability  Port ID</span>
<span class="go">RTP_Apic1             Eth1/1          120                    90:e2:ba:4b:fc:78</span>
<span class="go">...</span>
<span class="go">switch                Eth1/49         120        BR          Eth3/1</span>
<span class="go">switch                Eth1/50         120        BR          Eth4/1</span>
<span class="go">Total entries displayed: 14</span>
</pre></div>
</div>
<p>If presented with the (none)# prompt, use the command show interface brief to
verify what the status the interfaces are in.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">(none)#</span> show interface brief
<span class="go">--------------------------------------------------------------------------------</span>
<span class="go">Port   VRF          Status IP Address                              Speed     MTU</span>
<span class="go">--------------------------------------------------------------------------------</span>
<span class="go">mgmt0  --           up                                             1000      9000</span>


<span class="go">--------------------------------------------------------------------------------</span>
<span class="go">Ethernet      VLAN    Type Mode    Status Reason                   Speed     Port</span>
<span class="go">Interface                                                                    Ch #</span>
<span class="go">--------------------------------------------------------------------------------</span>
<span class="go">Eth1/1        0       eth  trunk   up     out-of-service           10G(D)    --</span>
<span class="go">...</span>
<span class="go">Eth1/47       0       eth  trunk   down   sfp-missing              10G(D)    --</span>
<span class="go">Eth1/48       0       eth  trunk   up     out-of-service           10G(D)    --</span>
<span class="go">Eth1/49       --      eth  routed  up     none                     40G(D)    --</span>
<span class="go">Eth1/49.1     2       eth  routed  up     none                     40G(D)    --</span>
<span class="go">Eth1/50       --      eth  routed  up     none                     40G(D)    --</span>
<span class="go">Eth1/50.2     2       eth  routed  up     none                     40G(D)    --</span>
<span class="go">...</span>
</pre></div>
</div>
<p>Alternatively, this information can also be found with the command
<strong>cat /mit/sys/lldp/inst/if-[eth1&#8211;&lt;PORT NUMBER&gt;]/summary</strong> in the
<strong>(none)#</strong> prompt to verify if there is any wiring issue:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">(none)#</span> cat /mit/sys/lldp/inst/if-<span class="se">\[</span>eth1--60<span class="se">\]</span>/summary

<span class="gp">#</span> LLDP Interface
<span class="go">id           : eth1/60</span>
<span class="go">adminRxSt    : enabled</span>
<span class="go">adminSt      : enabled</span>
<span class="go">adminTxSt    : enabled</span>
<span class="go">childAction  :</span>
<span class="go">descr        :</span>
<span class="go">dn           : sys/lldp/inst/if-[eth1/60]</span>
<span class="go">lcOwn        : local</span>
<span class="go">mac          : 7C:69:F6:0F:EA:EF</span>
<span class="go">modTs        : 2014-10-13T20:44:37.182+00:00</span>
<span class="go">monPolDn     : uni/fabric/monfab-default</span>
<span class="go">name         :</span>
<span class="go">operRxSt     : enabled</span>
<span class="go">operTxSt     : enabled</span>
<span class="go">portDesc     : topology/pod-1/paths-0/pathep-[eth1/60]</span>
<span class="go">portVlan     : unspecified</span>
<span class="go">rn           : if-[eth1/60]</span>
<span class="go">status       :</span>
<span class="go">sysDesc      :</span>
<span class="go">wiringIssues :</span>
</pre></div>
</div>
</div>
<div class="section" id="symptom-2">
<h3><a class="toc-backref" href="#id10">Symptom 2</a><a class="headerlink" href="#symptom-2" title="Permalink to this headline">¶</a></h3>
<p>In the Fabric membership, no TEP IP addresses are assigned to either leaf or
sprine switch, and the node has a status of “unsupported” and a role of
”unknown” listed under fabric membership.</p>
</div>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id11">Verification</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>If the switch has “unsupported” for its state, the device model (part number)
is not supported by the current APIC version. The command “acidiag fnvread” in
the APIC CLI will help to verify all nodes in the fabric.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic1:~&gt; acidiag fnvread</span>
<span class="go">      ID             Name    Serial Number         IP Address    Role        State   LastUpdMsgId</span>
<span class="go">-------------------------------------------------------------------------------------------------</span>
<span class="go">       0                       SAL12341234            0.0.0.0 unknown      unsupported   0</span>

<span class="gp">(none)#</span> cat /mit/uni/fabric/compcat-default/swhw-*/summary <span class="p">|</span> grep model
<span class="go">model        : N9K-C9336PQ</span>
<span class="go">model        : N9K-C9508</span>
<span class="go">model        : N9K-C9396PX</span>
<span class="go">model        : N9K-C93128TX</span>
<span class="gp">(none)#</span>
</pre></div>
</div>
</div>
<div class="section" id="resolution">
<h3><a class="toc-backref" href="#id12">Resolution</a><a class="headerlink" href="#resolution" title="Permalink to this headline">¶</a></h3>
<p>The device model or part number must match the catalog’s supported hardware.
The command grep model /mit/uni/fabric/compcat-default/swhw-*/summary in the
switch can be used to verify the catalog’s supported hardware:</p>
</div>
<div class="section" id="symptom-3">
<h3><a class="toc-backref" href="#id13">Symptom 3</a><a class="headerlink" href="#symptom-3" title="Permalink to this headline">¶</a></h3>
<p>The switch state shows “unknown”. The state can be corroborated by use of the
acidiag fnvread command in the APIC CLI.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic1:~&gt; acidiag fnvread</span>
<span class="go">      ID             Name    Serial Number         IP Address    Role        State   LastUpdMsgId</span>
<span class="go">-------------------------------------------------------------------------------------------------</span>
<span class="go">       0                       SAL1819SAN6            0.0.0.0 unknown      unknown   0</span>
</pre></div>
</div>
<p>There are a few causes that could cause this switch state:</p>
<ul class="simple">
<li>Node ID policy has not been posted to the APIC or the switch has not been
provisioned with the APIC GUI with the device’s specific serial number.</li>
<li>If the REST API was used to post the Node ID policy to the APIC, the serial
number that was posted to the APIC doesn’t match the actual serial number of
the device. The following switch CLI command can verify the serial number of
the device:</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">(none)#</span> cat /mit/sys/summary <span class="p">|</span> grep serial
<span class="go">serial       : SAL1819SAN6</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id14">Resolution</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Assign a Node ID to the device if one is missing to be configured as well as
making sure the provisioned serial number matches the actual device serial
number.</p>
</div>
<div class="section" id="symptom-4">
<h3><a class="toc-backref" href="#id15">Symptom 4</a><a class="headerlink" href="#symptom-4" title="Permalink to this headline">¶</a></h3>
<p>The leaf or spine is not discovered in the “Pod” folder in the GUI.</p>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id16">Verification</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>If the state from the <strong>cat /mit/sys/summary</strong> switch CLI shows out-of-service,
re-verify by going back through Symptom 1 verification steps.</p>
<p>If the state from the <strong>cat /mit/sys/summary</strong> switch CLI shows invalid-ver,
verify “Firmware Default Policy” via the APIC GUI.</p>
<a class="reference internal image-reference" href="_images/default-policy.png"><img alt="_images/default-policy.png" class="align-center" src="_images/default-policy.png" style="width: 750px;" /></a>
<p>Use the <strong>cat /mit/sys/summary</strong> CLI command to verify the state of the leaf or
spine:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">leaf101# cat /mit/sys/summary</span>
<span class="gp">#</span> System
<span class="go">address      : 0.0.0.0</span>
<span class="go">childAction  :</span>
<span class="go">currentTime  : 2014-10-14T18:14:26.861+00:00</span>
<span class="go">dn           : sys</span>
<span class="go">fabricId     : 1</span>
<span class="go">fabricMAC    : 00:22:BD:F8:19:FF</span>
<span class="go">id           : 0</span>
<span class="go">inbMgmtAddr  : 0.0.0.0</span>
<span class="go">lcOwn        : local</span>
<span class="go">modTs        : 2014-10-13T20:43:50.056+00:00</span>
<span class="go">mode         : unspecified</span>
<span class="go">monPolDn     : uni/fabric/monfab-default</span>
<span class="go">name         :</span>
<span class="go">oobMgmtAddr  : 0.0.0.0</span>
<span class="go">podId        : 1</span>
<span class="go">rn           : sys</span>
<span class="go">role         : leaf</span>
<span class="go">serial       : SAL1819SAN6</span>
<span class="go">state        : out-of-service</span>
<span class="go">status       :</span>
<span class="go">systemUpTime : 00:21:31:39.000</span>
</pre></div>
</div>
<p>If the state from the <strong>cat /mit/sys/summary</strong> CLI command shows in-service,
then the TEP IP address listed under the “address” field of the CLI output
should be pingable. If the switch&#8217;s TEP address is not reachable from the APIC,
a possible cause could be a switch certificate issue. Verify that the switch
is able to communicate with APIC via TCP port 12183.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">leaf101# netstat -a |grep 12183</span>
<span class="go">tcp        0      0 leaf101:12183           *:*                     LISTEN</span>
<span class="go">tcp        0      0 leaf101:12183           apic2:43371             ESTABLISHED</span>
<span class="go">tcp        0      0 leaf101:12183           apic1:49862             ESTABLISHED</span>
<span class="go">tcp        0      0 leaf101:12183           apic3:42332             ESTABLISHED</span>
</pre></div>
</div>
<p>If the switch is listening on TCP port 12183 but there are no established
sessions, assuming that IP connectivity between the switch and APIC has been
confirmed with ping test, verify SSL communication with the command
<strong>cat /tmp/logs/svc_ifc_policyelem.log | grep SSL</strong>.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">leaf101# cat /tmp/logs/svc_ifc_policyelem.log | grep SSL</span>
<span class="go">3952||14-08-02 21:06:53.875-08:00||ifm||DBG4||co=ifm||incoming connection established from 10.0.0.1:52038||../dme/common/src/ifm/./ServerEventHandler.cc||42   bico 52.241 3952||14-08-02 21:06:53.931-08:00||ifm||DBG4||co=ifm||openssl error during SSL_accept()||../dme/common/src/ifm/./IFMSSL.cc||185</span>
<span class="go">3952||14-08-02 21:06:53.931-08:00||ifm||DBG4||co=ifm||openssl: error:14094415:SSL routines:SSL3_READ_BYTES:sslv3 alert certificate expired||../dme/common/src/ifm/./IFMSSL.cc||198 3952||14-08-02 21:06:53.931-08:00||ifm||DBG3||co=ifm||incoming connection to peer terminated (protocol error)||../dme/common/src/ifm/./Peer.cc||227</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id17">Resolution</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>If this scenario is encountered, contact the Cisco Technical Assistance Center
support.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="apic.html" class="btn btn-neutral float-right" title="APIC High Availablity and Clustering">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="hw_bringup.html" class="btn btn-neutral" title="Initial Hardware Bringup"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Andres Vega, Bryan Deaver, Jerry Ye, Kannan Ponnuswamy, Loy Evans, Mike Timm, Paul Lesiak and Paul Raytick.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60418502-1', 'auto');
    ga('send', 'pageview');

  </script>
   

</body>
</html>
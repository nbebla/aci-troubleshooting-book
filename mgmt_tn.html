

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Management Tenant &mdash; ACI Troubleshooting Book 0.0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="ACI Troubleshooting Book 0.0.1 documentation" href="index.html"/>
        <link rel="next" title="Common Network Services" href="common.html"/>
        <link rel="prev" title="REST Interface" href="rest.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> ACI Troubleshooting Book</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="preface.html#authors-and-contributors">Authors and Contributors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#authors">Authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#distinguished-contributors">Distinguished Contributors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#dedications">Dedications</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#acknowledgments">Acknowledgments</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#book-writing-methodology">Book Writing Methodology</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#who-should-read-this-book">Who Should Read This Book?</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#organization-of-this-book">Organization of this Book</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="aci.html">Application Centric Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="aci_policy_model.html">ACI Policy Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#abstraction-model">Abstraction Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#everything-is-an-object">Everything is an Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#relevant-objects-and-relationships">Relevant Objects and Relationships</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#hierarchical-aci-object-model-and-the-infrastructure">Hierarchical ACI Object Model and the Infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#infrastructure-as-objects">Infrastructure as Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#build-object-use-object-to-build-policy-reuse-policy">Build object, use object to build policy, reuse policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#rest-api-just-exposes-the-object-model">REST API just exposes the object model</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#logical-model-resolved-model-concrete-model">Logical model, Resolved model, concrete model</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#formed-and-unformed-relationships">Formed and Unformed Relationships</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#declarative-end-state-and-promise-theory">Declarative End State and Promise Theory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Troubleshooting Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tools.html#apic-access-methods">APIC Access Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#programmatic-configuration-python">Programmatic Configuration (Python)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#fabric-node-access-methods">Fabric Node Access Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#exporting-information-from-the-fabric">Exporting information from the Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#external-data-collection-syslog-snmp-call-home">External Data Collection – Syslog, SNMP, Call-Home</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#health-scores">Health Scores</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#atomic-counters">Atomic Counters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ts_methodology.html">Troubleshooting Methodology</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ts_methodology.html#overall-methodology">Overall Methodology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="topology.html">Sample Reference Topology</a><ul>
<li class="toctree-l2"><a class="reference internal" href="topology.html#physical-fabric-topology">Physical Fabric Topology</a></li>
<li class="toctree-l2"><a class="reference internal" href="topology.html#logical-application-topology">Logical Application Topology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#naming-conventions">Naming Conventions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hw_bringup.html">Initial Hardware Bringup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hw_bringup.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_bringup.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_bringup.html#id2">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fabric_init.html">Fabric Initialization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fabric_init.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="fabric_init.html#fabric-verification">Fabric Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="fabric_init.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apic.html">Application Policy Infrastructure Controller (APIC) High Availability and Clustering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="apic.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#cluster-formation">Cluster Formation</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#majority-and-minority-handling-clustering-split-brains">Majority and Minority - Handling Clustering Split Brains</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id1">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id4">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id6">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id9">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id12">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id15">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="firmware.html">Firmware and Image Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#id1">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#id5">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="health.html">Faults / Health Scores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="health.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="health.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="health.html#id1">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rest.html">REST Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="rest.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="rest.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Management Tenant</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common Network Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="common.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="common.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="common.html#id15">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="unicast.html">Unicast Data Plane Forwarding and Reachability</a><ul>
<li class="toctree-l2"><a class="reference internal" href="unicast.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicast.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicast.html#id1">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pol_cntr.html">Policies and Contracts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pol_cntr.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="pol_cntr.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bridged2ext.html">Bridged Connectivity to External Networks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="bridged2ext.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridged2ext.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridged2ext.html#id3">Problem Description:</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridged2ext.html#id5">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="routed2ext.html">Routed Connectivity to External Networks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#fabric-verification">Fabric Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#problem-description">Problem description</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#id1">Problem description</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#id3">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vmm_ucs.html">Virtual Machine Manager and UCS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#id2">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#id6">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmm_ucs.html#id9">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="l4l7.html">L4-L7 Service Insertion</a><ul>
<li class="toctree-l2"><a class="reference internal" href="l4l7.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="l4l7.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fn_crash_ts.html">ACI Fabric Node and Process Crash Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fn_crash_ts.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="fn_crash_ts.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apic_crash_ts.html">APIC Process Crash Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="apic_crash_ts.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic_crash_ts.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#overview">Overview</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ACI Troubleshooting Book</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div></div>
          <div role="main" class="document">
            
  <div class="section" id="management-tenant">
<h1>Management Tenant<a class="headerlink" href="#management-tenant" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id5">Overview</a><ul>
<li><a class="reference internal" href="#fabric-management-routing" id="id6">Fabric Management Routing</a></li>
<li><a class="reference internal" href="#out-of-band-management" id="id7">Out-Of-Band Management</a></li>
<li><a class="reference internal" href="#inband-management" id="id8">Inband Management</a></li>
<li><a class="reference internal" href="#layer-2-inband-management" id="id9">Layer 2 Inband Management</a></li>
<li><a class="reference internal" href="#layer-2-configuration-notes" id="id10">Layer 2 Configuration Notes</a></li>
<li><a class="reference internal" href="#layer-3" id="id11">Layer 3</a></li>
<li><a class="reference internal" href="#layer-3-inband-configuration-notes" id="id12">Layer 3 Inband Configuration Notes</a></li>
<li><a class="reference internal" href="#apic-management-routing" id="id13">APIC Management Routing</a></li>
<li><a class="reference internal" href="#fabric-node-switch-routing" id="id14">Fabric Node (Switch) Routing</a></li>
<li><a class="reference internal" href="#management-failover" id="id15">Management Failover</a></li>
<li><a class="reference internal" href="#management-epg-configuration" id="id16">Management EPG Configuration</a></li>
<li><a class="reference internal" href="#fabric-verification" id="id17">Fabric Verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#problem-description" id="id18">Problem Description</a><ul>
<li><a class="reference internal" href="#symptom" id="id19">Symptom</a></li>
<li><a class="reference internal" href="#verification" id="id20">Verification</a></li>
<li><a class="reference internal" href="#resolution" id="id21">Resolution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id1" id="id22">Problem Description</a><ul>
<li><a class="reference internal" href="#id2" id="id23">Symptom</a></li>
<li><a class="reference internal" href="#id3" id="id24">Verification</a></li>
<li><a class="reference internal" href="#id4" id="id25">Resolution</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id5">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The management tenant is a pre-defined tenant in the ACI policy model that
addresses policies related to inband and out of band management connectivity
of the ACI Fabric.</p>
<p>This chapter presents an overview of how the management tenant functions, the
verification steps used to confirm a working out-of-band management
configuration for the example reference topology, and potential issues that
relate to the management tenant. The displays taken on a working fabric can
then be used as a reference resource to aid in troubleshooting issues with the
management tenant functions.</p>
<p>The example reference topology that is used only has out-of-band management
configured, so in order to show any inband management functions, all inband
management information shown in this book will be captured from another fabric.</p>
<div class="section" id="fabric-management-routing">
<h3><a class="toc-backref" href="#id6">Fabric Management Routing</a><a class="headerlink" href="#fabric-management-routing" title="Permalink to this headline">¶</a></h3>
<p>The ACI fabric provides both in-band and out-of-band management access
options. The following paragraphs will describe the internal system behavior,
including routing and failover for the APIC and fabric nodes (switches).</p>
</div>
<div class="section" id="out-of-band-management">
<h3><a class="toc-backref" href="#id7">Out-Of-Band Management</a><a class="headerlink" href="#out-of-band-management" title="Permalink to this headline">¶</a></h3>
<p>Out-of-band (OOB) management provides management communications through
configuration of dedicated physical interfaces on the APICs and fabric nodes
(switches). The initial APIC setup script prompts to configure the OOB
management IP address by a series of configuration prompts:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">Out-of-band management configuration ...</span>
<span class="go">Enter the IP address for out-of-band management: 10.122.254.141/24</span>
<span class="go">Enter the IP address of the default gateway [None]: 10.122.254.1</span>
<span class="go">Enter the interface speed/duplex mode [auto]:</span>
</pre></div>
</div>
<p>Once the fabric is initialized and discovered, the OOB addresses can be
configured for the fabric nodes (switches) through any of the object model
interfaces (GUI, API, CLI).</p>
<p>On the APIC, the OOB configuration creates an interface called oobmgmt. Keep
in mind throughout this book that when viewing configuration information on an
APIC, the APIC is built on a Linux host operating system, and some of the
abbreviated information might be more systems related than traditional Cisco
NXOS/IOS command or output structure related. As an example, to view the
interface oobmgmt configuration, connect to the APIC CLI, enter the command ip
add show dev oobmgmt. The dev keyword is more of a Linux context moniker for
“device” and the order of the command is different from a traditional Cisco
show command. Below is the output produced from the <strong>ip add show dev oobmgmt</strong>
command:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic2:~&gt; ip add show dev oobmgmt</span>
<span class="go"> 8: oobmgmt: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP</span>
<span class="go">  link/ether 24:e9:b3:15:dd:60 brd ff:ff:ff:ff:ff:ff</span>
<span class="go">  inet 10.122.254.212/24 brd 10.122.254.255 scope global oobmgmt</span>
<span class="go">  inet6 fe80::26e9:b3ff:fe15:dd60/64 scope link</span>
<span class="go">  valid_lft forever preferred_lft forever</span>
<span class="go"> admin@RTP_Apic2:~&gt;</span>
</pre></div>
</div>
<p>On the fabric nodes (switches), the OOB configuration is applied to the
management interface eth0 (aka mgmt0). To view the eth0 interface
configuration, connect to the node CLI, enter the following command and
observe the produced output:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# ip add show dev eth0</span>
<span class="go"> 2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000</span>
<span class="go">  link/ether 88:f0:31:db:e7:f0 brd ff:ff:ff:ff:ff:ff</span>
<span class="go">  inet 10.122.254.241/24 brd 10.122.254.255 scope global eth0</span>
<span class="go">  inet6 fe80::8af0:31ff:fedb:e7f0/64 scope link</span>
<span class="go">  valid_lft forever preferred_lft forever</span>
<span class="go"> rtp_leaf1#</span>
</pre></div>
</div>
</div>
<div class="section" id="inband-management">
<h3><a class="toc-backref" href="#id8">Inband Management</a><a class="headerlink" href="#inband-management" title="Permalink to this headline">¶</a></h3>
<p>Inband management provides management communications through configuration of
one or more front-panel (data plane) ports on the fabric leaf nodes
(switches). Inband management requires a dedicated pool of IP addresses that
do not directly extend outside the fabric. Inband management can be configured
in two modes: Layer 2 and Layer 3.</p>
</div>
<div class="section" id="layer-2-inband-management">
<h3><a class="toc-backref" href="#id9">Layer 2 Inband Management</a><a class="headerlink" href="#layer-2-inband-management" title="Permalink to this headline">¶</a></h3>
<p>With Layer 2 inband management, the inband management addresses assigned to
the APICs and fabric nodes (switches) are only accessible from networks
directly connected to the leaf nodes.</p>
<a class="reference internal image-reference" href="_images/inband.jpg"><img alt="_images/inband.jpg" class="align-center" src="_images/inband.jpg" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In this model, the fabric inband addresses are not accessible from networks
not directly connected to the fabric.</p>
</div>
<div class="section" id="layer-2-configuration-notes">
<h3><a class="toc-backref" href="#id10">Layer 2 Configuration Notes</a><a class="headerlink" href="#layer-2-configuration-notes" title="Permalink to this headline">¶</a></h3>
<p>A minimum of 2 VLANs are required</p>
<ul class="simple">
<li>1 for the Inband management EPG<ul>
<li>1 for the application EPG mapped to the leaf port providing connectivity
outside the fabric</li>
<li>Configuring a second Bridge Domain (BD) for the application EPG is
optional and it is also valid to map the application EPG to the default BD
named &#8216;inb&#8217;</li>
</ul>
</li>
<li>The subnet gateway(s) configured for the BD&#8217;s are used as next-hop addresses
and should be unique host addresses</li>
</ul>
</div>
<div class="section" id="layer-3">
<h3><a class="toc-backref" href="#id11">Layer 3</a><a class="headerlink" href="#layer-3" title="Permalink to this headline">¶</a></h3>
<p>With Layer 3 inband management, the inband management addresses assigned to
the APICs and fabric nodes are accessible by remote networks by virtue of
configuring a L3 Routed Outside network object.</p>
<a class="reference internal image-reference" href="_images/inband2.jpg"><img alt="_images/inband2.jpg" class="align-center" src="_images/inband2.jpg" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="layer-3-inband-configuration-notes">
<h3><a class="toc-backref" href="#id12">Layer 3 Inband Configuration Notes</a><a class="headerlink" href="#layer-3-inband-configuration-notes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>A minimum of 2 VLANs are required<ul>
<li>1 for the Inband EPG</li>
<li>1 for the application EPG mapped to the leaf port providing access outside
the fabric</li>
</ul>
</li>
<li>Configuring a second BD for the application EPG is optional - it is also
valid to map the application EPG to the default &#8216;inb&#8217; BD</li>
<li>The subnet gateway(s) configured for the BD&#8217;s are used as next-hop addresses
and should be unique (i.e. unused) host addresses</li>
</ul>
<p>Regardless of whether using L2 or L3, the encapsulation VLAN used for the
Inband EPG is used to create a sub-interface on the APIC using the name format
bond0.&lt;vlan&gt;, where &lt;vlan&gt; is the VLAN configured as the encapsulation for the
Inband EPG. As an example, the following is the output from the APIC CLI show
command:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@fab2_apic1:~&gt; ip add show bond0.10</span>
<span class="go">116: bond0.10@bond0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1496 qdisc noqueue state UP</span>
<span class="go">        link/ether 64:12:25:a7:df:3f brd ff:ff:ff:ff:ff:ff</span>
<span class="go">        inet 5.5.5.141/24 brd 5.5.5.255 scope global bond0.10</span>
<span class="go">        inet6 fe80::6612:25ff:fea7:df3f/64 scope link</span>
<span class="go">                 valid_lft forever preferred_lft forever</span>
</pre></div>
</div>
<p>On the fabric nodes, inband interfaces are created as part of the mgmt:inb VRF:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">fab2_leaf4# show ip int vrf mgmt:inb</span>
<span class="go">IP Interface Status for VRF &quot;mgmt:inb&quot;</span>
<span class="go">vlan27, Interface status: protocol-up/link-up/admin-up, iod: 128,</span>
<span class="go">        IP address: 5.5.5.1, IP subnet: 5.5.5.0/24 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; BD gateway address</span>
<span class="go">        IP address: 5.5.5.137, IP subnet: 5.5.5.137/32 secondary</span>
<span class="go">        IP broadcast address: 255.255.255.255</span>
<span class="go">        IP primary address route-preference: 1, tag: 0</span>
</pre></div>
</div>
<p>In the output above, the gateway address(es) for the BD is also configured on
the same interface. This is true for all leaf nodes (switches) that are
configured for inband.</p>
</div>
<div class="section" id="apic-management-routing">
<h3><a class="toc-backref" href="#id13">APIC Management Routing</a><a class="headerlink" href="#apic-management-routing" title="Permalink to this headline">¶</a></h3>
<p>The APIC internal networking configuration utilizes the Linux iproute2
utilities, which provides a combination of routing policy database and
multiple routing tables used to implement routing on the controllers. When
both inband and out-of-band management are configured, the APIC uses the
following forwarding logic:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Packets that come in an interface, go out that same interface</li>
<li>Packets sourced from the APIC, destined to a directly connected network,
go out the directly connected interface</li>
<li>Packets sourced from the APIC, destined to a remote network, prefer
inband, followed by out-of-band</li>
</ol>
</div></blockquote>
<p>An APIC controller always prefers the in-band management interface to the
out-of-band management interface as long as in-band is available. This
behavior cannot be changed with configuration. APIC controllers should have
two ways to reach a single management network with inband being the primary
path and out-of-band being the backup path.</p>
<p>To view the configured routing tables on the APIC, execute the following
command cat /etc/iproute2/rt_tables:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@fab2_apic1:~&gt; cat /etc/iproute2/rt_tables</span>
<span class="gp">#</span>
<span class="gp">#</span> reserved values
<span class="gp">#</span>
<span class="go">255 local</span>
<span class="go">254 main</span>
<span class="go">253 default</span>
<span class="go">0 unspec</span>
<span class="gp">#</span>
<span class="gp">#</span> <span class="nb">local</span>
<span class="gp">#</span><span class="nb"></span>
<span class="gp">#</span><span class="m">1</span> inr.ruhep
<span class="go">1 overlay</span>
<span class="go">2 oobmgmt</span>
<span class="go">admin@fab2_apic1:~&gt;</span>
</pre></div>
</div>
<p>The local and main routing tables are Linux defaults. The local routing table
is populated with information from all of the interfaces configured with IP
addresses on the APIC. Theoverlay, oobmgmt, and ibmgmt routing tables are
APIC-specific and are populated with the relevant routes for each network. The
entries from the 3 APIC-specific routing tables are used to populate the main
routing table. The contents of each routing table can be viewed by using the
command ip route show &lt;table&gt;. For example:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@fab2_apic1:~&gt; ip route show table oobmgmt</span>
<span class="go">default via 10.122.254.1 dev oobmgmt src 10.122.254.141</span>
<span class="go">10.122.254.1 dev oobmgmt scope link src 10.122.254.141</span>
<span class="go">169.254.254.0/24 dev lxcbr0 scope link</span>
<span class="go">admin@fab2_apic1:~&gt;</span>
</pre></div>
</div>
<p>The decision of which routing table is used for the lookup is based on an
ordered list of rules in the routing policy database. Use ip rule show command
to view the the routing policy database:</p>
<a class="reference internal image-reference" href="_images/original.png"><img alt="_images/original.png" class="align-center" src="_images/original.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The main routing table used for packets originating from the APIC, shows 2
default routes:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@fab2_apic1:~&gt; ip route show</span>
<span class="go">default via 10.122.254.1 dev oobmgmt metric 16</span>
<span class="go">10.0.0.0/16 via 10.0.0.30 dev bond0.4093 src 10.0.0.1</span>
<span class="go">10.0.0.30 dev bond0.4093 scope link src 10.0.0.1</span>
<span class="go">10.122.254.0/24 dev oobmgmt proto kernel scope link src 10.122.254.141</span>
<span class="go">10.122.254.1 dev oobmgmt scope link src 10.122.254.141</span>
<span class="go">169.254.1.0/24 dev teplo-1 proto kernel scope link src 169.254.1.1</span>
<span class="go">169.254.254.0/24 dev lxcbr0 proto kernel scope link src 169.254.254.254</span>
<span class="go">admin@fab2_apic1:~&gt;</span>
</pre></div>
</div>
<p>The metric 16 on the default route out the oobmgmt interface is what makes the
default route via inband (bond0.10) preferable.</p>
</div>
<div class="section" id="fabric-node-switch-routing">
<h3><a class="toc-backref" href="#id14">Fabric Node (Switch) Routing</a><a class="headerlink" href="#fabric-node-switch-routing" title="Permalink to this headline">¶</a></h3>
<p>Routing on the fabric nodes (switches) is split between Linux and NX-OS.
Unlike the APIC configuration, the routing table segregation on the fabric
nodes is implemented using multiple VRF instances. The configured VRFs on a
fabric node can be viewed by using the <strong>show vrf</strong> command:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">fab2_leaf1# show vrf</span>
<span class="go">VRF-Name                           VRF-ID State   Reason</span>
<span class="go">black-hole                              3 Up      --</span>
<span class="go">management                              2 Up      --</span>
<span class="go">mgmt:inb                               11 Up      --</span>
<span class="go">overlay-1                               9 Up      --</span>
</pre></div>
</div>
<p>Although the management VRF exists in the above output, the associated routing
table is empty. This is because the management VRF mapped to the out-of-band
network configuration, is handled by Linux. This means that on the fabric
nodes, the Linux configuration does not use multiple routing tables and the
content of the main routing table is only populated by the out-of-band network
configuration.</p>
<p>To view the contents of each VRF routing table in NX-OS, use the <strong>show ip
route vrf &lt;vrf&gt;</strong> command. For example:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">fab2_leaf1# show ip route vrf mgmt:inb</span>
<span class="go">IP Route Table for VRF &quot;mgmt:inb&quot;</span>
<span class="go">&#39;*&#39; denotes best ucast next-hop</span>
<span class="go">&#39;**&#39; denotes best mcast next-hop</span>
<span class="go">&#39;[x/y]&#39; denotes [preference/metric]</span>
<span class="go">&#39;%&lt;string&gt;&#39; in via output denotes VRF &lt;string&gt;</span>

<span class="go">3.3.3.0/24, ubest/mbest: 1/0, attached, direct, pervasive</span>
<span class="go">    *via 10.0.224.65%overlay-1, [1/0], 02:31:46, static</span>
<span class="go">3.3.3.1/32, ubest/mbest: 1/0, attached</span>
<span class="go">    *via 3.3.3.1, Vlan47, [1/0], 02:31:46, local</span>
<span class="go">5.5.5.0/24, ubest/mbest: 1/0, attached, direct, pervasive</span>
<span class="go">    *via 10.0.224.65%overlay-1, [1/0], 07:48:24, static</span>
<span class="go">5.5.5.1/32, ubest/mbest: 1/0, attached</span>
<span class="go">    *via 5.5.5.1, Vlan40, [1/0], 07:48:24, local</span>
<span class="go">5.5.5.134/32, ubest/mbest: 1/0, attached</span>
</pre></div>
</div>
</div>
<div class="section" id="management-failover">
<h3><a class="toc-backref" href="#id15">Management Failover</a><a class="headerlink" href="#management-failover" title="Permalink to this headline">¶</a></h3>
<p>In theory the out-of-band network functions as a backup when inband management
connectivity is unavailable on the APIC. However, APIC has does not run any
routing protocol and so will not be able to intelligently fallback to use OOB
interface in case of any upstream connectivity issues over inband. The inband
management network on APIC changes in the following scenarios:</p>
<ul class="simple">
<li>The bond0 interface on the APIC goes down</li>
<li>The encapsulation configuration on the Inband EPG is removed</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that the above failover behavior is specific to APIC and the same
failover behavior is unavailable on the fabric switches due to the switches
inband and OOB interface belong to two different VRFs.</p>
</div>
</div>
<div class="section" id="management-epg-configuration">
<h3><a class="toc-backref" href="#id16">Management EPG Configuration</a><a class="headerlink" href="#management-epg-configuration" title="Permalink to this headline">¶</a></h3>
<p>Some of the fabric services, such as NTP, DNS, etc., provide the option to
configure a Management EPG attribute. This specifies whether inband or
out-of-band is used for communication by these services. This setting only
affects the behavior of the fabric nodes, not the APICs. With the exception of
the VM Provider configuration, the APIC follows the forwarding logic described
in the APIC Management Routing section earlier in this chapter. The VM
Provider configuration has an optional Management EPG setting, but only able
to select an EPG tied to the In-Band Management EPG.</p>
</div>
<div class="section" id="fabric-verification">
<h3><a class="toc-backref" href="#id17">Fabric Verification</a><a class="headerlink" href="#fabric-verification" title="Permalink to this headline">¶</a></h3>
<p>In the following section, displays are collected from the reference topology
to show a working fabric configuration. This verification is only for
out-of-band management.</p>
<a class="reference internal image-reference" href="_images/topo.png"><img alt="_images/topo.png" class="align-center" src="_images/topo.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="out-of-band-verification">
<h4>Out of Band Verification<a class="headerlink" href="#out-of-band-verification" title="Permalink to this headline">¶</a></h4>
<p>The first step is to verify the configuration of the oobmgmt interface on the
APIC using the command <strong>ip addr show dev oobmgmt</strong> on all three APIC&#8217;s. The
interfaces need to be in the up state and the expected IP addresses need to be
assigned with the proper masks. To connect to the various fabric nodes, there
are several options but if once logged into at least one of the APIC&#8217;s use the
output of <strong>show fabric membership</strong> to see which node-names and VTEP IP
addresses can be used to connect via SSH in order to verify operations.</p>
<p>Verification of the oobmgmt interface address assignment and interface status
on RTP_Apic1:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic1:~&gt; ip addr show dev oobmgmt</span>
<span class="go">8: oobmgmt: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP</span>
<span class="go"> link/ether 24:e9:b3:15:a0:ee brd ff:ff:ff:ff:ff:ff</span>
<span class="go"> inet 10.122.254.211/24 brd 10.122.254.255 scope global oobmgmt</span>
<span class="go"> inet6 fe80::26e9:b3ff:fe15:a0ee/64 scope link</span>
<span class="go"> valid_lft forever preferred_lft forever</span>
</pre></div>
</div>
<p>Verification of the oobmgmt interface address assignment and interface status on RTP_Apic2:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic2:~&gt; ip addr show dev oobmgmt</span>
<span class="go">8: oobmgmt: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP</span>
<span class="go"> link/ether 24:e9:b3:15:dd:60 brd ff:ff:ff:ff:ff:ff</span>
<span class="go"> inet 10.122.254.212/24 brd 10.122.254.255 scope global oobmgmt</span>
<span class="go"> inet6 fe80::26e9:b3ff:fe15:dd60/64 scope link</span>
<span class="go"> valid_lft forever preferred_lft forever</span>
<span class="go">admin@RTP_Apic2:~&gt;</span>
</pre></div>
</div>
<p>Verification of the oobmgmt interface address assignment and interface status on RTP_Apic3:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic3:~&gt; ip addr show dev oobmgmt</span>
<span class="go">8: oobmgmt: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP</span>
<span class="go"> link/ether 18:e7:28:2e:17:de brd ff:ff:ff:ff:ff:ff</span>
<span class="go"> inet 10.122.254.213/24 brd 10.122.254.255 scope global oobmgmt</span>
<span class="go"> inet6 fe80::1ae7:28ff:fe2e:17de/64 scope link</span>
<span class="go"> valid_lft forever preferred_lft forever</span>
<span class="go">admin@RTP_Apic3:~&gt;</span>
</pre></div>
</div>
<p>Verification of the fabric node membership and their respective TEP address
assignment as seen from RTP_Apic2 (would be the same on all controllers under
in a normal state):</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic2:~&gt; show fabric membership</span>
<span class="gp">#</span> Executing <span class="nb">command</span>: cat /aci/fabric/inventory/fabric-membership/clients/summary

<span class="go">clients:</span>
<span class="go">serial-number node-id node-name  model         role  ip               decomissioned supported-model</span>
<span class="go">------------- ------- ---------- ------------  ----- ---------------- ------------- ---------------</span>
<span class="go">SAL1819SAN6   101     rtp_leaf1   N9K-C9396PX  leaf  172.16.136.95/32  no            yes</span>
<span class="go">SAL172682S0   102     rtp_leaf2   N9K-C93128TX leaf  172.16.136.91/32  no            yes</span>
<span class="go">SAL1802KLJF   103     rtp_leaf3   N9K-C9396PX  leaf  172.16.136.92/32  no            yes</span>
<span class="go">FGE173400H2   201     rtp_spine1  N9K-C9508    spine 172.16.136.93/32  no            yes</span>
<span class="go">FGE173400H7   202     rtp_spine2  N9K-C9508    spine 172.16.136.94/32  no            yes</span>
<span class="go">admin@RTP_Apic2:~&gt;</span>
</pre></div>
</div>
<p>To verify the OOB mgmt on the fabric switch, use the attach command on the
APIC to connect to a fabric switch via the VTEP address, then execute the ip
addr show dev eth0 command for each switch, and again ensure that the
interface state is UP, the ip address and netmask are correct, etc:</p>
<p>Verification of the OOB management interface (eth0) on fabric node rtp_leaf1:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# ip addr show dev eth0</span>
<span class="go">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000</span>
<span class="go"> link/ether 88:f0:31:db:e7:f0 brd ff:ff:ff:ff:ff:ff</span>
<span class="go"> inet 10.122.254.241/24 brd 10.122.254.255 scope global eth0</span>
<span class="go"> inet6 fe80::8af0:31ff:fedb:e7f0/64 scope link</span>
<span class="go"> valid_lft forever preferred_lft forever</span>
<span class="go">rtp_leaf1#</span>
</pre></div>
</div>
<p>Verification of the OOB management interface (eth0) on fabric node rtp_leaf2:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf2# ip addr show dev eth0</span>
<span class="go">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000</span>
<span class="go"> link/ether 00:22:bd:f8:34:c0 brd ff:ff:ff:ff:ff:ff</span>
<span class="go"> inet 10.122.254.242/24 brd 10.122.254.255 scope global eth0</span>
<span class="go"> inet6 fe80::222:bdff:fef8:34c0/64 scope link</span>
<span class="go"> valid_lft forever preferred_lft forever</span>
<span class="go">rtp_leaf2#</span>
</pre></div>
</div>
<p>Verification of the OOB management interface (eth0) on fabric node rtp_leaf3:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf3# ip addr show dev eth0</span>
<span class="go">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000</span>
<span class="go"> link/ether 7c:69:f6:10:6d:18 brd ff:ff:ff:ff:ff:ff</span>
<span class="go"> inet 10.122.254.243/24 brd 10.122.254.255 scope global eth0</span>
<span class="go"> inet6 fe80::7e69:f6ff:fe10:6d18/64 scope link</span>
<span class="go"> valid_lft forever preferred_lft forever</span>
<span class="go">rtp_leaf3#</span>
</pre></div>
</div>
<p>When looking at the spine, the command used is <strong>show interface mgmt0</strong> to
ensure the proper ip address and netmask is assigned. Verification of the OOB
management interface on rtp_spine1:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_spine1# show int mgmt0</span>
<span class="go">mgmt0 is up</span>
<span class="go">admin state is up,</span>
<span class="go"> Hardware: GigabitEthernet, address: 0022.bdfb.f256 (bia 0022.bdfb.f256)</span>
<span class="go"> Internet Address is 10.122.254.244/24</span>
<span class="go"> MTU 9000 bytes, BW 1000000 Kbit, DLY 10 usec</span>
<span class="go"> reliability 255/255, txload 1/255, rxload 1/255</span>
<span class="go"> Encapsulation ARPA, medium is broadcast</span>
<span class="go"> Port mode is routed</span>
<span class="go"> full-duplex, 1000 Mb/s</span>
<span class="go"> Beacon is turned off</span>
<span class="go"> Auto-Negotiation is turned on</span>
<span class="go"> Input flow-control is off, output flow-control is off</span>
<span class="go"> Auto-mdix is turned off</span>
<span class="go"> EtherType is 0x0000</span>
<span class="go"> 1 minute input rate 0 bits/sec, 0 packets/sec</span>
<span class="go"> 1 minute output rate 0 bits/sec, 0 packets/sec</span>
<span class="go"> Rx</span>
<span class="go"> 256791 input packets 521 unicast packets 5228 multicast packets</span>
<span class="go"> 251042 broadcast packets 26081550 bytes</span>
<span class="go"> Tx</span>
<span class="go"> 679 output packets 456 unicast packets 217 multicast packets</span>
<span class="go"> 6 broadcast packets 71294 bytes</span>
<span class="go">rtp_spine1#</span>
</pre></div>
</div>
<p>To verify that the spine has the proper default gateway configuration, use the
command <strong>ip route show</strong> as seen here for rtp_spine1:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_spine1# ip route show</span>
<span class="go">default via 10.122.254.1 dev eth6</span>
<span class="go">10.122.254.0/24 dev eth6 proto kernel scope link src 10.122.254.244</span>
<span class="go">127.1.0.0/16 dev psdev0 proto kernel scope link src 127.1.1.27</span>
<span class="go">rtp_spine1#</span>
</pre></div>
</div>
<p>The same validation for rtp_spine2 looks similar to spine1 as shown:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_spine2# show int mgmt0</span>
<span class="go">mgmt0 is up</span>
<span class="go">admin state is up,</span>
<span class="go"> Hardware: GigabitEthernet, address: 0022.bdfb.fa00 (bia 0022.bdfb.fa00)</span>
<span class="go"> Internet Address is 10.122.254.245/24</span>
<span class="go"> MTU 9000 bytes, BW 1000000 Kbit, DLY 10 usec</span>
<span class="go"> reliability 255/255, txload 1/255, rxload 1/255</span>
<span class="go"> Encapsulation ARPA, medium is broadcast</span>
<span class="go"> Port mode is routed</span>
<span class="go"> full-duplex, 1000 Mb/s</span>
<span class="go"> Beacon is turned off</span>
<span class="go"> Auto-Negotiation is turned on</span>
<span class="go"> Input flow-control is off, output flow-control is off</span>
<span class="go"> Auto-mdix is turned off</span>
<span class="go"> EtherType is 0x0000</span>
<span class="go"> 1 minute input rate 0 bits/sec, 0 packets/sec</span>
<span class="go"> 1 minute output rate 0 bits/sec, 0 packets/sec</span>
<span class="go"> Rx</span>
<span class="go"> 256216 input packets 345 unicast packets 5218 multicast packets</span>
<span class="go"> 250653 broadcast packets 26007756 bytes</span>
<span class="go"> Tx</span>
<span class="go"> 542 output packets 312 unicast packets 225 multicast packets</span>
<span class="go"> 5 broadcast packets 59946 bytes</span>
<span class="go">rtp_spine2#</span>
</pre></div>
</div>
<p>And to see the routing table:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_spine2# ip route show</span>
<span class="go">default via 10.122.254.1 dev eth6</span>
<span class="go">10.122.254.0/24 dev eth6 proto kernel scope link src 10.122.254.245</span>
<span class="go">127.1.0.0/16 dev psdev0 proto kernel scope link src 127.1.1.27</span>
<span class="go">rtp_spine2#</span>
</pre></div>
</div>
<p>To verify APIC routing use the command cat /etc/iproute2/rt_tables:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic1:~&gt; cat /etc/iproute2/rt_tables</span>
<span class="gp">#</span>
<span class="gp">#</span> reserved values
<span class="gp">#</span>
<span class="go">255 local</span>
<span class="go">254 main</span>
<span class="go">253 default</span>
<span class="go">0 unspec</span>
<span class="gp">#</span>
<span class="gp">#</span> <span class="nb">local</span>
<span class="gp">#</span><span class="nb"></span>
<span class="gp">#</span><span class="m">1</span> inr.ruhep
<span class="go">2 oobmgmt</span>
<span class="go">1 overlay</span>
<span class="go">admin@RTP_Apic1:~&gt;</span>
</pre></div>
</div>
<p>The output of the ip route show tells us that there are two routing tables on
our sample reference topology, one for out-of-band management and one for the
overlay.</p>
<p>The next output to verify is the out-of-band management routing table entries
using the command <strong>ip route show table oobmgmt</strong> . There should be a default
route pointed at the default gateway IP address and out-of-band management
interface (dev oobmgmt) with a source IP address that matches the IP address
of the out-of-band management interface.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic1:~&gt; ip route show table oobmgmt</span>
<span class="go">default via 10.122.254.1 dev oobmgmt src 10.122.254.211</span>
<span class="go">10.122.254.0/24 dev oobmgmt scope link</span>
<span class="go">169.254.254.0/24 dev lxcbr0 scope link</span>
<span class="go">admin@RTP_Apic1:~&gt;</span>
</pre></div>
</div>
<p>The next output to verify is the output of <strong>ip rule show</strong> which shows how the
APIC chooses which routing table is used for the lookup:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic1:~&gt; ip rule show</span>
<span class="go">0: from all lookup local</span>
<span class="go">32762: from 10.122.254.211 lookup oobmgmt</span>
<span class="go">32763: from 172.16.0.1 lookup overlay</span>
<span class="go">32764: from 172.16.0.1 lookup overlay</span>
<span class="go">32765: from 10.122.254.211 lookup oobmgmt</span>
<span class="go">32766: from all lookup main</span>
<span class="go">32767: from all lookup default</span>
<span class="go">admin@RTP_Apic1:~&gt;</span>
</pre></div>
</div>
<p>Finally the ip route show command will show how the global routing table is
configured on an APIC for out-of-band management. The oobmgmt metric is 16
which has no impact on this situation but if an inband management
configuration was applied, the inband would not have a metric and would have a
preference over the out-of-band management route.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic3:~&gt; ip route show</span>
<span class="go">default via 10.122.254.1 dev oobmgmt metric 16</span>
<span class="go">10.122.254.0/24 dev oobmgmt proto kernel scope link src 10.122.254.213</span>
<span class="go">169.254.1.0/24 dev teplo-1 proto kernel scope link src 169.254.1.1</span>
<span class="go">169.254.254.0/24 dev lxcbr0 proto kernel scope link src 169.254.254.254</span>
<span class="go">172.16.0.0/16 via 172.16.0.30 dev bond0.3500 src 172.16.0.3</span>
<span class="go">172.16.0.30 dev bond0.3500 scope link src 172.16.0.3</span>
<span class="go">admin@RTP_Apic3:~&gt;</span>
</pre></div>
</div>
<p>To ensure that the VRF is configured for the fabric nodes, verify with the
output of show vrf.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show vrf</span>
<span class="go"> VRF-Name                           VRF-ID State    Reason</span>
<span class="go"> black-hole                              3 Up       --</span>
<span class="go"> management                              2 Up       --</span>
<span class="go"> overlay-1                               4 Up       --</span>

<span class="go">rtp_leaf1#</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="problem-description">
<h2><a class="toc-backref" href="#id18">Problem Description</a><a class="headerlink" href="#problem-description" title="Permalink to this headline">¶</a></h2>
<p>Can SSH to APIC but cannot reach a fabric node via SSH.</p>
<div class="section" id="symptom">
<h3><a class="toc-backref" href="#id19">Symptom</a><a class="headerlink" href="#symptom" title="Permalink to this headline">¶</a></h3>
<p>All three APIC&#8217;s are accessible via the out-of-band management network via
SSH, HTTPS, ping, etc. The fabric nodes are only accessible via ping, but
should be accessible via SSH as well.</p>
</div>
<div class="section" id="verification">
<h3><a class="toc-backref" href="#id20">Verification</a><a class="headerlink" href="#verification" title="Permalink to this headline">¶</a></h3>
<p>The switch opens up ports using the linux iptables tool. However, the current
state of the tables cannot be viewed with out root access. Without root
access, it is still possible to verify what ports are open by running an nmap
scan against a fabric node:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">Computer:tmp user1$</span> nmap -A -T5 -PN 10.122.254.241
<span class="go">Starting Nmap 6.46 ( http://nmap.org ) at 2014-10-15 09:29 PDT</span>
<span class="go">Nmap scan report for rtp-leaf1.cisco.com (10.122.254.241)</span>
<span class="go">Host is up (0.082s latency).</span>
<span class="go">Not shown: 998 filtered ports</span>
<span class="go">PORT STATE SERVICE VERSION</span>
<span class="go">179/tcp closed bgp</span>
<span class="go">443/tcp open http nginx 1.4.0</span>
<span class="go">|_http-methods: No Allow or Public header in OPTIONS response (status code 400)</span>
<span class="go">|_http-title: 400 The plain HTTP request was sent to HTTPS port</span>
<span class="go">| ssl-cert: Subject: commonName=APIC/organizationName=Default Company Ltd/stateOrProvinceName=CA/countryName=US</span>
<span class="go">| Not valid before: 2013-11-13T18:43:13+00:00</span>
<span class="go">|_Not valid after: Can&#39;t parse; string is &quot;20580922184313Z&quot;</span>
<span class="go">|_ssl-date: 2020-02-18T08:57:12+00:00; +5y125d16h27m34s from local time.</span>
<span class="go">| tls-nextprotoneg:</span>
<span class="go">|_ http/1.1</span>
<span class="go">Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .</span>
<span class="go">Nmap done: 1 IP address (1 host up) scanned in 16.61 seconds</span>

<span class="go"> * The output shows that only bgp and https ports are open, but not ssh on</span>
<span class="go">   this fabric node. This indicates that the policy has not been fully</span>
<span class="go">   pushed down to the fabric nodes.</span>
<span class="go"> * Reviewing the policy on the APIC reveals that the subnet is missing from</span>
<span class="go">   the External Network Instance Profile:</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/Missing_subnet_ENIP_1.png"><img alt="_images/Missing_subnet_ENIP_1.png" class="align-center" src="_images/Missing_subnet_ENIP_1.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="resolution">
<h3><a class="toc-backref" href="#id21">Resolution</a><a class="headerlink" href="#resolution" title="Permalink to this headline">¶</a></h3>
<p>Once a subnet is added in the GUI, the ports are added to the iptables on the
fabric nodes and is then accessible via SSH:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> ssh admin@10.122.254.241
<span class="go">Password:</span>
<span class="go">Cisco Nexus Operating System (NX-OS) Software</span>
<span class="go">TAC support: http://www.cisco.com/tac</span>
<span class="go">Copyright (c) 2002-2014, Cisco Systems, Inc. All rights reserved.</span>
<span class="go">The copyrights to certain works contained in this software are</span>
<span class="go">owned by other third parties and used and distributed under</span>
<span class="go">license. Certain components of this software are licensed under</span>
<span class="go">the GNU General Public License (GPL) version 2.0 or the GNU</span>
<span class="go">Lesser General Public License (LGPL) Version 2.1. A copy of each</span>
<span class="go">such license is available at</span>
<span class="go">http://www.opensource.org/licenses/gpl-2.0.php and</span>
<span class="go">http://www.opensource.org/licenses/lgpl-2.1.php</span>
<span class="go">rtp_leaf1#</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id22">Problem Description</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Previously reachable APIC or fabric node not reachable via out-of-band
management interface.</p>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id23">Symptom</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>When committing a node management policy change or when clearing the
configuration of a fabric node, decommissioning that fabric node and
re-accepting that node back into the fabric through fabric membership, the
out-of-band IP connectivity to an APIC and/or fabric switch gets lost. In this
case rtp_leaf2 and RTP_Apic2 lost IP connectivity via the out-of-band
managment interfaces.</p>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id24">Verification</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Upon verifying the fabric, scenarios such as overlapping IP addresses, between
the APIC and switch, lead to loss of connectivity:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic2:~&gt; ip add show dev oobmgmt</span>
<span class="go">23: oobmgmt: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP</span>
<span class="go"> link/ether 24:e9:b3:15:dd:60 brd ff:ff:ff:ff:ff:ff</span>
<span class="go"> inet 10.122.254.212/24 brd 10.122.254.255 scope global oobmgmt</span>
<span class="go"> inet6 fe80::26e9:b3ff:fe15:dd60/64 scope link</span>
<span class="go"> valid_lft forever preferred_lft forever</span>
<span class="go">admin@RTP_Apic2:~&gt;</span>
</pre></div>
</div>
<p>and the leaf:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf2# ip addr show dev eth0</span>
<span class="go">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000</span>
<span class="go"> link/ether 00:22:bd:f8:34:c0 brd ff:ff:ff:ff:ff:ff</span>
<span class="go"> inet 10.122.254.212/24 brd 10.122.254.255 scope global eth0</span>
<span class="go"> inet6 fe80::222:bdff:fef8:34c0/64 scope link</span>
<span class="go"> valid_lft forever preferred_lft forever</span>
<span class="go">rtp_leaf2#</span>
</pre></div>
</div>
<ul class="simple">
<li>When checking the fabric node policies, the following is seen on the default
Node Management Address policy, and there are no connectivity groups applied
to this default policy.</li>
</ul>
<a class="reference internal image-reference" href="_images/Node_Mgmt_Cfg.png"><img alt="_images/Node_Mgmt_Cfg.png" class="align-center" src="_images/Node_Mgmt_Cfg.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id25">Resolution</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>When a fabric node joins the fabric, it randomly gets an IP address assigned
from the pool, and there are a few activities that can cause the IP address on
a node to change. Generally speaking any activity that causes the APIC or
fabric node to come up from scratch and be removed from the network or be
assigned to a new policy can cause it to be readdressed.</p>
<p>In situations where a fabric member is simply renumbered there may only be a
need to investigate what new IP address was assigned. In some other rare
circumstances where the IP address overlaps with another device, Cisco TAC
should be contacted to investigate further.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="common.html" class="btn btn-neutral float-right" title="Common Network Services">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rest.html" class="btn btn-neutral" title="REST Interface"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Andres Vega, Bryan Deaver, Jerry Ye, Kannan Ponnuswamy, Loy Evans, Mike Timm, Paul Lesiak and Paul Raytick.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60418502-1', 'auto');
    ga('send', 'pageview');

  </script>
   

</body>
</html>


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Virtual Machine Manager and UCS &mdash; ACI Troubleshooting Book 0.0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="ACI Troubleshooting Book 0.0.1 documentation" href="index.html"/>
        <link rel="next" title="L4-L7 Service Insertion" href="l4l7.html"/>
        <link rel="prev" title="Routed Connectivity to External Networks" href="routed2ext.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> ACI Troubleshooting Book</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="preface.html#authors-and-contributors">Authors and Contributors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#authors">Authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#distinguished-contributors">Distinguished Contributors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#dedications">Dedications</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#acknowledgments">Acknowledgments</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#book-writing-methodology">Book Writing Methodology</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#who-should-read-this-book">Who Should Read This Book?</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#organization-of-this-book">Organization of this Book</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="aci.html">Application Centric Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="aci_policy_model.html">ACI Policy Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#abstraction-model">Abstraction Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#everything-is-an-object">Everything is an Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#relevant-objects-and-relationships">Relevant Objects and Relationships</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#hierarchical-aci-object-model-and-the-infrastructure">Hierarchical ACI Object Model and the Infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#infrastructure-as-objects">Infrastructure as Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#build-object-use-object-to-build-policy-reuse-policy">Build object, use object to build policy, reuse policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#rest-api-just-exposes-the-object-model">REST API just exposes the object model</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#logical-model-resolved-model-concrete-model">Logical model, Resolved model, concrete model</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#formed-and-unformed-relationships">Formed and Unformed Relationships</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci_policy_model.html#declarative-end-state-and-promise-theory">Declarative End State and Promise Theory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Troubleshooting Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tools.html#apic-access-methods">APIC Access Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#programmatic-configuration-python">Programmatic Configuration (Python)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#fabric-node-access-methods">Fabric Node Access Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#exporting-information-from-the-fabric">Exporting information from the Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#external-data-collection-syslog-snmp-call-home">External Data Collection – Syslog, SNMP, Call-Home</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#health-scores">Health Scores</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#atomic-counters">Atomic Counters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ts_methodology.html">Troubleshooting Methodology</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ts_methodology.html#overall-methodology">Overall Methodology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="topology.html">Sample Reference Topology</a><ul>
<li class="toctree-l2"><a class="reference internal" href="topology.html#physical-fabric-topology">Physical Fabric Topology</a></li>
<li class="toctree-l2"><a class="reference internal" href="topology.html#logical-application-topology">Logical Application Topology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#naming-conventions">Naming Conventions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hw_bringup.html">Initial Hardware Bringup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hw_bringup.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_bringup.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_bringup.html#id2">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fabric_init.html">Fabric Initialization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fabric_init.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="fabric_init.html#fabric-verification">Fabric Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="fabric_init.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apic.html">Application Policy Infrastructure Controller (APIC) High Availability and Clustering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="apic.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#cluster-formation">Cluster Formation</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#majority-and-minority-handling-clustering-split-brains">Majority and Minority - Handling Clustering Split Brains</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id1">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id4">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id6">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id9">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id12">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic.html#id15">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="firmware.html">Firmware and Image Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#id1">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware.html#id5">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="health.html">Faults / Health Scores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="health.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="health.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="health.html#id1">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rest.html">REST Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="rest.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="rest.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mgmt_tn.html">Management Tenant</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mgmt_tn.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="mgmt_tn.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="mgmt_tn.html#id1">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common Network Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="common.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="common.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="common.html#id15">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="unicast.html">Unicast Data Plane Forwarding and Reachability</a><ul>
<li class="toctree-l2"><a class="reference internal" href="unicast.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicast.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicast.html#id1">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pol_cntr.html">Policies and Contracts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pol_cntr.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="pol_cntr.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bridged2ext.html">Bridged Connectivity to External Networks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="bridged2ext.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridged2ext.html#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridged2ext.html#id3">Problem Description:</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridged2ext.html#id5">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="routed2ext.html">Routed Connectivity to External Networks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#fabric-verification">Fabric Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#problem-description">Problem description</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#id1">Problem description</a></li>
<li class="toctree-l2"><a class="reference internal" href="routed2ext.html#id3">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Virtual Machine Manager and UCS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="l4l7.html">L4-L7 Service Insertion</a><ul>
<li class="toctree-l2"><a class="reference internal" href="l4l7.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="l4l7.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fn_crash_ts.html">ACI Fabric Node and Process Crash Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fn_crash_ts.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="fn_crash_ts.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apic_crash_ts.html">APIC Process Crash Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="apic_crash_ts.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="apic_crash_ts.html#problem-description">Problem Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#overview">Overview</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ACI Troubleshooting Book</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div></div>
          <div role="main" class="document">
            
  <div class="section" id="virtual-machine-manager-and-ucs">
<h1>Virtual Machine Manager and UCS<a class="headerlink" href="#virtual-machine-manager-and-ucs" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id12">Overview</a></li>
<li><a class="reference internal" href="#problem-description" id="id13">Problem Description</a><ul>
<li><a class="reference internal" href="#symptom-1" id="id14">Symptom 1</a></li>
<li><a class="reference internal" href="#verification" id="id15">Verification</a></li>
<li><a class="reference internal" href="#symptom-2" id="id16">Symptom 2</a></li>
<li><a class="reference internal" href="#id1" id="id17">Verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id2" id="id18">Problem Description</a><ul>
<li><a class="reference internal" href="#symptom" id="id19">Symptom</a></li>
<li><a class="reference internal" href="#id3" id="id20">Verification</a></li>
<li><a class="reference internal" href="#id4" id="id21">Symptom 2</a></li>
<li><a class="reference internal" href="#id5" id="id22">Verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6" id="id23">Problem Description</a><ul>
<li><a class="reference internal" href="#id7" id="id24">Symptom</a></li>
<li><a class="reference internal" href="#id8" id="id25">Verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id9" id="id26">Problem Description</a><ul>
<li><a class="reference internal" href="#id10" id="id27">Symptom</a></li>
<li><a class="reference internal" href="#id11" id="id28">Verification</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id12">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Virtual Machine Manager integration allows for the fabric to extend network
policy and policy group definitions into virtual switches residing on a
hypervisor. This integration automates critical network plumbing steps that
typically stand as delays in the deployment of virtual and compute resources,
by automatically configuring the required fabric side and hypervisor virtual
switch encapsulation.</p>
<p>The general hierarchy of VMM configuration is as shown in the diagram below:</p>
<a class="reference internal image-reference" href="_images/vmm.jpg"><img alt="_images/vmm.jpg" class="align-center" src="_images/vmm.jpg" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="problem-description">
<h2><a class="toc-backref" href="#id13">Problem Description</a><a class="headerlink" href="#problem-description" title="Permalink to this headline">¶</a></h2>
<p>When attached to a Cisco UCS Fabric Interconnect, two hosts are unable to
reach one another or unable to resolve one another’s MAC addresses.</p>
<div class="section" id="symptom-1">
<h3><a class="toc-backref" href="#id14">Symptom 1</a><a class="headerlink" href="#symptom-1" title="Permalink to this headline">¶</a></h3>
<p>Packet captures running on the sending host, show that it is in fact being
transmitted, however it never reaches the destination host. Creating static
ARP entries on both devices for one another shows that traffic allowed by
policy is able to be exchanged via ICMP, etc.</p>
<p>The UCS Fabric Interconnect is configured with two uplinks that are configured
as disjoint layer-2 domains.</p>
</div>
<div class="section" id="verification">
<h3><a class="toc-backref" href="#id15">Verification</a><a class="headerlink" href="#verification" title="Permalink to this headline">¶</a></h3>
<p>The problem in this situation is that the UCS FI has two uplinks with disjoint
layer-2, where the VLAN that is being used for the ARP is using the non-ACI
uplink as the designated forwarder. This means that the fabric will not
receive the ARP frames and as a result cannot unicast them to the host. The
easiest way to determine if this problem is impacting the environment, is to
use the following command on the UCS FI in NX-OS mode, substituting the VLAN
ID for the one that is attached to the EPG. This can be determined by using
the &#8220;show platform software enm internal info vlandb id &lt;vlan&gt;&#8221; command as
shown below:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">FI-A(nxos)# show platform software enm internal info vlandb id 248</span>

<span class="go">vlan_id 248</span>
<span class="go">-------------</span>
<span class="go">Designated receiver: Po103</span>
<span class="go">Membership:</span>
<span class="go">Po103</span>
<span class="go">FI-A(nxos)#</span>
</pre></div>
</div>
<p>If the designated receiver is not the port-channel facing the ACI fabric, the
uplink pinning settings in LAN manager will need to be adjusted. Use the LAN
Uplink Manager in UCS to set the VLANs dedicated to ACI use to be pinned to
the ACI fabric facing uplink.</p>
<p>For more information, please reference the Network Configuration section on
<a class="reference external" href="http://www.cisco.com/c/en/us/td/docs/unified_computing/ucs/sw/gui/config/guide/1-4/b_UCSM_GUI_Configuration_Guide_1_4/b_UCSM_GUI_Configuration_Guide_1_4_chapter_010000.html">Configuring LAN Pin Groups</a> in the Cisco UCS Manager GUI Configuration Guide.</p>
</div>
<div class="section" id="symptom-2">
<h3><a class="toc-backref" href="#id16">Symptom 2</a><a class="headerlink" href="#symptom-2" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>ARP requests are egressing ESX host on UCS blade, but not making it to
the destination</li>
<li>VM hosted on C-series appliance directly attached to fabric is able to
reach the BD anycast gateway</li>
<li>VM hosted on B-series chassis blade attached to fabric is unable to
reach the BD anycast gateway</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id17">Verification</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>In this situation there are two VMs, one on a UCS blade chassis and another on
a C200, and they are unable to ping one another, while on the same EPG. The
C200 VM is able to ping the unicast gateway, however the UCS blade hosted VM
is not able to ping the gateway.</p>
<p>The vSphere 5.5 pktcap-uw tool can be used to determine if outbound ARP
requests are in fact leaving the VM and hitting the virtual switch.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">~ # pktcap-uw --uplink vmnic3</span>
<span class="go">The name of the uplink is vmnic3</span>
<span class="go">No server port specifed, select 38100 as the port</span>
<span class="go">Output the packet info to console.</span>
<span class="go">Local CID 2</span>
<span class="go">Listen on port 38100</span>
<span class="go">Accept...Vsock connection from port 1027 cid 2</span>
<span class="go">01:04:51.765509[1] Captured at EtherswitchDispath point, TSO not enabled, Checksum not offloaded and not verified, VLAN tag 602, length 60.</span>
<span class="go">Segment[0] ---- 60 bytes:</span>
<span class="go">0x0000:  ffff ffff ffff 0050 56bb cccf 0806 0001</span>
<span class="go">0x0010:  0800 0604 0001 0050 56bb cccf 0a01 000b</span>
<span class="go">0x0020:  0000 0000 0000 0a01 0001 0000 0000 0000</span>
<span class="go">0x0030:  0000 0000 0000 0000 0000 0000</span>
</pre></div>
</div>
<p>By monitoring the packet count on the Veth### interface on the UCS in NX-OS
mode, it is possible to confirm the packets were being received.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">tsi-aci-ucsb-A(nxos)# show int Veth730</span>
<span class="go">Vethernet730 is up</span>
<span class="go">    Bound Interface is Ethernet1/1/3</span>
<span class="go">    Port description is server 1/3, VNIC eth3</span>
<span class="go">    Hardware is Virtual, address is 000d.ecb1.a000</span>
<span class="go">    Port mode is trunk</span>
<span class="go">    Speed is auto-speed</span>
<span class="go">    Duplex mode is auto</span>
<span class="go">  300 seconds input rate 0 bits/sec, 0 packets/sec</span>
<span class="go">  300 seconds output rate 0 bits/sec, 0 packets/sec</span>
<span class="go">  Rx</span>
<span class="go">    36 unicast packets  3694 multicast packets  3487 broadcast packets</span>
<span class="go">    7217 input packets  667170 bytes</span>
<span class="go">    0 input packet drops</span>
<span class="go">  Tx</span>
<span class="go">    433 unicast packets  12625 multicast packets  44749 broadcast packets</span>
<span class="go">    57807 output packets  4453489 bytes</span>
<span class="go">    0 flood packets</span>
<span class="go">    0 output packet drops</span>
</pre></div>
</div>
<p>So the problem is between the UCS fabric links and the leaf interfaces.
Checking the counters on the leaf indicates no broadcast packets were
ingressing.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">Ethernet1/27 is up</span>
<span class="go">admin state is up, Dedicated Interface</span>
<span class="go">  Belongs to po2</span>
<span class="go">  Hardware: 100/1000/10000/auto Ethernet, address: 7c69.f610.6d33 (bia 7c69.f610.6d33)</span>
<span class="go">  MTU 9000 bytes, BW 10000000 Kbit, DLY 1 usec</span>
<span class="go">  reliability 255/255, txload 1/255, rxload 1/255</span>
<span class="go">  Encapsulation ARPA, medium is broadcast</span>
<span class="go">  Port mode is trunk</span>
<span class="go">  full-duplex, 10 Gb/s, media type is 10G</span>
<span class="go">  Beacon is turned off</span>
<span class="go">  Auto-Negotiation is turned on</span>
<span class="go">  Input flow-control is off, output flow-control is off</span>
<span class="go">  Auto-mdix is turned off</span>
<span class="go">  Rate mode is dedicated</span>
<span class="go">  Switchport monitor is off</span>
<span class="go">  EtherType is 0x8100</span>
<span class="go">  EEE (efficient-ethernet) : n/a</span>
<span class="go">  Last link flapped 09:09:44</span>
<span class="go">  Last clearing of &quot;show interface&quot; counters never</span>
<span class="go">  4 interface resets</span>
<span class="go">  30 seconds input rate 75 bits/sec, 0 packets/sec</span>
<span class="go">  30 seconds output rate 712 bits/sec, 0 packets/sec</span>
<span class="go">  Load-Interval #2: 5 minute (300 seconds)</span>
<span class="go">    input rate 808 bps, 1 pps; output rate 616 bps, 0 pps</span>
<span class="go">  RX</span>
<span class="go">    193 unicast packets  5567 multicast packets  17365 broadcast packets</span>
<span class="go">    23125 input packets  2185064 bytes</span>
<span class="go">    0 jumbo packets  0 storm suppression packets</span>
<span class="go">    0 runts  0 giants  0 CRC  0 no buffer</span>
<span class="go">    0 input error  0 short frame  0 overrun   0 underrun  0 ignored</span>
<span class="go">    0 watchdog  0 bad etype drop  0 bad proto drop  0 if down drop</span>
<span class="go">    0 input with dribble  0 input discard</span>
<span class="go">    0 Rx pause</span>
<span class="go">  TX</span>
<span class="go">    129 unicast packets  5625 multicast packets  17900 broadcast packets</span>
<span class="go">    23654 output packets  1952861 bytes</span>
<span class="go">    0 jumbo packets</span>
<span class="go">    0 output error  0 collision  0 deferred  0 late collision</span>
<span class="go">    0 lost carrier  0 no carrier  0 babble  0 output discard</span>
<span class="go">    0 Tx pause</span>
</pre></div>
</div>
<p>This indicates that traffic is egressing the ESX host, however not making it
through to the leaf. One possible cause for this is that the frames are being
tagged on upon leaving the ESX host, however are being stripped and placed on
the native VLAN. The UCS configuration, specifically VLAN manager, can be
checked and verified if VLAN 602 is incorrectly set as the native VLAN.</p>
<a class="reference internal image-reference" href="_images/ScreenShot2014-10-15at6.49.50PM.png"><img alt="_images/ScreenShot2014-10-15at6.49.50PM.png" class="align-center" src="_images/ScreenShot2014-10-15at6.49.50PM.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>This means that frames egressing the UCS FI would be untagged heading towards
the fabric, and thus would not be categorized into the appropriate EPG. By
unmarking the VLAN as native, the frames are properly tagged and then
categorized as being members of the EPG, and ICMP can immediately begin to
function.</p>
</div>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id18">Problem Description</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Virtual Machine Manager function is unable to register vCenter with APIC</p>
<div class="section" id="symptom">
<h3><a class="toc-backref" href="#id19">Symptom</a><a class="headerlink" href="#symptom" title="Permalink to this headline">¶</a></h3>
<p>When attempting to register a vCenter with APIC, one or more of the following
faults is raised:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">F606262 [FSM:FAILED]: VMM Add-Controller FSM: comp/prov-VMware/ctrlr-[RTPACILab]-TestVcenter Failed to retrieve ServiceContent from the vCenter server 10.122.253.152(FSM:ifc:vmmmgr:CompCtrlrAdd)</span>
<span class="go">F606351 [FSM:FAILED]: Task for updating comp:PolCont(TASK:ifc:vmmmgr:CompPolContUpdateCtrlrPol)</span>
<span class="go">F16438 [FSM:STAGE:FAILED]: Establish connection Stage: comp/prov-VMware/ctrlr-[RTPACILab]-TestVcenter Failed to retrieve ServiceContent from the vCenter server 10.122.253.152(FSM-STAGE:ifc:vmmmgr:CompCtrlrAdd:Connect)</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id20">Verification</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>These faults typically indicate that there is an issue reaching vCenter from
the APIC. Typical causes for this include:</p>
<blockquote>
<div><ul class="simple">
<li>The VMM is configured to use the Out of Band management (OOBM) network
to access vCenter however is on a separate subnet and has no route to
reach that vCenter</li>
<li>The IP address entered for the vCenter is incorrect</li>
</ul>
</div></blockquote>
<p>Log into the APIC and attempt a simple ping test to the remote vCenter:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic1:~&gt; ping 10.122.253.152</span>
<span class="go">PING 10.122.253.152 (10.122.253.152) 56(84) bytes of data.</span>
<span class="go">From 64.102.253.234 icmp_seq=1 Destination Host Unreachable</span>
<span class="go">From 64.102.253.234 icmp_seq=2 Destination Host Unreachable</span>
<span class="go">From 64.102.253.234 icmp_seq=3 Destination Host Unreachable</span>
<span class="go">From 64.102.253.234 icmp_seq=4 Destination Host Unreachable</span>
<span class="go">^C</span>
</pre></div>
</div>
<p>In this case vCenter is not reachable from the APIC. By default the APIC will
use the OOB interface for reaching remotely managed devices, so this would
indicate that there is either a misconfiguration on the APIC or that the
vCenter is unreachable by that address.</p>
<p>The first step is to verify if a proper default route is configured. This can
be verified by navigating to the Tenants section, entering the mgmt tenant,
and then inspecting the Node Management Addresses. If out of band management
node management addresses have been configured, verify that the proper default
gateway has been entered in that location.</p>
<a class="reference internal image-reference" href="_images/ScreenShot2014-10-15at8.24.19PM.png"><img alt="_images/ScreenShot2014-10-15at8.24.19PM.png" class="align-center" src="_images/ScreenShot2014-10-15at8.24.19PM.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The default gateway is configured as 10.122.254.254/24</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic1:~&gt; ping 10.122.254.254</span>
<span class="go">PING 10.122.254.254 (10.122.254.254) 56(84) bytes of data.</span>
<span class="go">From 10.122.254.211 icmp_seq=1 Destination Host Unreachable</span>
<span class="go">From 10.122.254.211 icmp_seq=2 Destination Host Unreachable</span>
<span class="go">From 10.122.254.211 icmp_seq=3 Destination Host Unreachable</span>
<span class="go">From 10.122.254.211 icmp_seq=4 Destination Host Unreachable</span>
<span class="go">^C</span>
</pre></div>
</div>
<p>The Unreachable state indicates that the gateway is improperly configured, and
this misconfiguration can be corrected by setting it to the appropriate
10.122.254.1.</p>
<p>After modifying the configured Out-of-Band gateway address:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">admin@RTP_Apic1:~&gt; ping 10.122.254.152</span>
<span class="go">PING 10.122.254.152 (10.122.254.152) 56(84) bytes of data.</span>
<span class="go">64 bytes from 10.122.254.152: icmp_seq=1 ttl=64 time=0.245 ms</span>
<span class="go">64 bytes from 10.122.254.152: icmp_seq=2 ttl=64 time=0.258 ms</span>
<span class="go">64 bytes from 10.122.254.152: icmp_seq=3 ttl=64 time=0.362 ms</span>
<span class="go">64 bytes from 10.122.254.152: icmp_seq=4 ttl=64 time=0.344 ms</span>
<span class="go">^C</span>
</pre></div>
</div>
<p>The complete management configuration is as follows:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;fvTenant</span> <span class="na">name=</span><span class="s">&quot;mgmt&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;fvBD</span> <span class="na">name=</span><span class="s">&quot;inb&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;aaaDomainRef</span> <span class="na">name=</span><span class="s">&quot;mgmt&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;mgmtMgmtP</span> <span class="na">name=</span><span class="s">&quot;default&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;mgmtInB</span> <span class="na">name=</span><span class="s">&quot;default&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;mgmtOoB</span> <span class="na">name=</span><span class="s">&quot;default&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;mgmtRsOoBProv</span> <span class="na">tnVzOOBBrCPName=</span><span class="s">&quot;oob_contract&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/mgmtOoB&gt;</span>
    <span class="nt">&lt;/mgmtMgmtP&gt;&lt;a&gt;</span>p
    <span class="nt">&lt;fvCtx</span> <span class="na">name=</span><span class="s">&quot;inb&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;fvCtx</span> <span class="na">name=</span><span class="s">&quot;oob&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;dnsLbl</span> <span class="na">name=</span><span class="s">&quot;default&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/fvCtx&gt;</span>
    <span class="nt">&lt;vzOOBBrCP</span> <span class="na">name=</span><span class="s">&quot;oob_contract&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;vzSubj</span> <span class="na">name=</span><span class="s">&quot;oob_subject&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;vzRsSubjFiltAtt</span> <span class="na">tnVzFilterName=</span><span class="s">&quot;default&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;vzRsSubjFiltAtt</span> <span class="na">tnVzFilterName=</span><span class="s">&quot;ssh&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/vzSubj&gt;</span>
    <span class="nt">&lt;/vzOOBBrCP&gt;</span>
    <span class="nt">&lt;vzFilter</span> <span class="na">name=</span><span class="s">&quot;ssh&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;vzEntry</span> <span class="na">name=</span><span class="s">&quot;ssh&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/vzFilter&gt;</span>
    <span class="nt">&lt;fvnsAddrInst</span> <span class="na">name=</span><span class="s">&quot;rtp_leaf3ooboobaddr&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;fvnsUcastAddrBlk</span> <span class="na">from=</span><span class="s">&quot;10.122.254.243&quot;</span> <span class="na">to=</span><span class="s">&quot;10.122.254.243&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/fvnsAddrInst&gt;</span>
    <span class="nt">&lt;fvnsAddrInst</span> <span class="na">name=</span><span class="s">&quot;RTP_Apic3ooboobaddr&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;fvnsUcastAddrBlk</span> <span class="na">from=</span><span class="s">&quot;10.122.254.213&quot;</span> <span class="na">to=</span><span class="s">&quot;10.122.254.213&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/fvnsAddrInst&gt;</span>
    <span class="nt">&lt;fvnsAddrInst</span> <span class="na">name=</span><span class="s">&quot;RTP_Apic1ooboobaddr&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;fvnsUcastAddrBlk</span> <span class="na">from=</span><span class="s">&quot;10.122.254.211&quot;</span> <span class="na">to=</span><span class="s">&quot;10.122.254.211&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/fvnsAddrInst&gt;</span>
    <span class="nt">&lt;fvnsAddrInst</span> <span class="na">name=</span><span class="s">&quot;RTP_Apic2ooboobaddr&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;fvnsUcastAddrBlk</span> <span class="na">from=</span><span class="s">&quot;10.122.254.212&quot;</span> <span class="na">to=</span><span class="s">&quot;10.122.254.212&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/fvnsAddrInst&gt;</span>
    <span class="nt">&lt;fvnsAddrInst</span> <span class="na">name=</span><span class="s">&quot;rtp_spine1ooboobaddr&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;fvnsUcastAddrBlk</span> <span class="na">from=</span><span class="s">&quot;10.122.254.244&quot;</span> <span class="na">to=</span><span class="s">&quot;10.122.254.244&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/fvnsAddrInst&gt;</span>
    <span class="nt">&lt;fvnsAddrInst</span> <span class="na">name=</span><span class="s">&quot;rtp_leaf1ooboobaddr&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;fvnsUcastAddrBlk</span> <span class="na">from=</span><span class="s">&quot;10.122.254.241&quot;</span> <span class="na">to=</span><span class="s">&quot;10.122.254.241&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/fvnsAddrInst&gt;</span>
    <span class="nt">&lt;fvnsAddrInst</span> <span class="na">name=</span><span class="s">&quot;rtp_leaf2ooboobaddr&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;fvnsUcastAddrBlk</span> <span class="na">from=</span><span class="s">&quot;10.122.254.242&quot;</span> <span class="na">to=</span><span class="s">&quot;10.122.254.242&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/fvnsAddrInst&gt;</span>
    <span class="nt">&lt;fvnsAddrInst</span> <span class="na">name=</span><span class="s">&quot;rtp_spine2ooboobaddr&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;fvnsUcastAddrBlk</span> <span class="na">from=</span><span class="s">&quot;10.122.254.245&quot;</span> <span class="na">to=</span><span class="s">&quot;10.122.254.245&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/fvnsAddrInst&gt;</span>
    <span class="nt">&lt;mgmtExtMgmtEntity</span> <span class="na">name=</span><span class="s">&quot;default&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;mgmtInstP</span> <span class="na">name=</span><span class="s">&quot;oob_emei&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;mgmtRsOoBCons</span> <span class="na">tnVzOOBBrCPName=</span><span class="s">&quot;oob_contract&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;mgmtSubnet</span> <span class="na">ip=</span><span class="s">&quot;0.0.0.0/0&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/mgmtInstP&gt;</span>
    <span class="nt">&lt;/mgmtExtMgmtEntity&gt;</span>
<span class="nt">&lt;/fvTenant&gt;</span>
</pre></div>
</div>
<p>Now it is possible to verify that the vCenter VMM is reachable:</p>
<a class="reference internal image-reference" href="_images/validcontrollerconfigcopy.png"><img alt="_images/validcontrollerconfigcopy.png" class="align-center" src="_images/validcontrollerconfigcopy.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id21">Symptom 2</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>The following fault is raised in the VMM manager</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">F16438 [FSM:STAGE:FAILED]: Establish connection Stage: comp/prov-VMware/ctrlr-[RTPACILab]-172.31.222.24 Failed to find datacenter BldgE in vCenter(FSM-STAGE:ifc:vmmmgr:CompCtrlrAdd:Connect)</span>
<span class="go">F606262 [FSM:FAILED]: VMM Add-Controller FSM: comp/prov-VMware/ctrlr-[RTPACILab]-172.31.222.24 Failed to find datacenter BldgE in vCenter(FSM:ifc:vmmmgr:CompCtrlrAdd)</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id22">Verification</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Ensure that the datacenter name in vCenter matches the &#8220;Datacenter&#8221; property
configured in the VMM Controller policy configuration</p>
<a class="reference internal image-reference" href="_images/ScreenShot2014-10-16at12.37.11PM.png"><img alt="_images/ScreenShot2014-10-16at12.37.11PM.png" class="align-center" src="_images/ScreenShot2014-10-16at12.37.11PM.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In the above screenshot, the Datacenter name is purposely misconfigured as
BldgE instead of BldgF</p>
</div>
</div>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id23">Problem Description</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>Virtual Machine Manager (VMM) unassociation fails to delete Distributed
Virtual Switch (DVS) in vCenter</p>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id24">Symptom</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>After removing a Virtual Machine Manager (VMM) configuration or removing a
Virtual Machine Manager (VMM) domain from an End Point Group (EPG), the
associated virtual port groups or DVS are not removed from the vCenter
configuration.</p>
</div>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#id25">Verification</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Check to see that the port groups are not currently in use by a virtual
machine network adapter.</p>
<p>This can be verified from the vCenter GUI, by accessing the settings for a
virtual machine and individually inspecting the network backing for the vNIC
adapters</p>
<a class="reference internal image-reference" href="_images/ScreenShot2014-10-16at12.49.53PM.png"><img alt="_images/ScreenShot2014-10-16at12.49.53PM.png" class="align-center" src="_images/ScreenShot2014-10-16at12.49.53PM.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Another mechanism by which this can be verified is by inspecting the DVS
settings, and viewing the Virtual Machines that are associated with the DVS.</p>
<a class="reference internal image-reference" href="_images/ScreenShot2014-10-16at12.51.06PM.png"><img alt="_images/ScreenShot2014-10-16at12.51.06PM.png" class="align-center" src="_images/ScreenShot2014-10-16at12.51.06PM.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The list of virtual machines that are currently using a distributed virtual
port group can also be found using the APIC GUI, by navigating to the VM
Networking section, navigating into the Provider, the Domain, into the DVS,
the expanding the port groups, and looking at each individual port group.</p>
<a class="reference internal image-reference" href="_images/ScreenShot2014-10-16at12.26.34PM.png"><img alt="_images/ScreenShot2014-10-16at12.26.34PM.png" class="align-center" src="_images/ScreenShot2014-10-16at12.26.34PM.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>To resolve this particular issue, the backing on the Virtual Machine VNICs
must be removed. This can be accomplished by either removing the Virtual
Adapter entirely, or by changing the Virtual Adapter network backing to one
that is not present on the DVS, including a local standard virtual switch or
some other DVP.</p>
</div>
</div>
<div class="section" id="id9">
<h2><a class="toc-backref" href="#id26">Problem Description</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<p>Virtual Machine Manager hosted VMs are unable to reach the fabric, get learned
by the fabric or reach their default gateway through a UCS Fabric Interconnect.</p>
<div class="section" id="id10">
<h3><a class="toc-backref" href="#id27">Symptom</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Checking the endpoint table on the fabric does not show any new endpoints
being learned, although the Distributed Virtual Port groups are being created
on the vSwitch and VMs.</p>
<p>The VMs are unable to ping their gateway or other VMs</p>
</div>
<div class="section" id="id11">
<h3><a class="toc-backref" href="#id28">Verification</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>For these symptoms the first step is to check to see if the endpoint table on
the leaf to which the UCS is attached is learning any endpoints in the EPG.
The MAC address for the VM in question is 00:50:56:BB:D5:08, and it is unable
to reach its default gateway</p>
<a class="reference internal image-reference" href="_images/ScreenShot2014-10-16at2.14.18PM.png"><img alt="_images/ScreenShot2014-10-16at2.14.18PM.png" class="align-center" src="_images/ScreenShot2014-10-16at2.14.18PM.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Upon inspecting the &#8220;show endpoint detail&#8221; output on the leaf, the MAC for the
VM is missing from the output.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show endpoint detail</span>
<span class="go">Legend:</span>

<span class="go"> O - peer-attached    H - vtep             a - locally-aged     S - static</span>
<span class="go"> V - vpc-attached     p - peer-aged        L - local            M - span</span>
<span class="go"> s - static-arp       B - bounce</span>
<span class="go">+---------------+---------------+-----------------+--------------+-------------+------------------------------+</span>
<span class="go">      VLAN/       Encap           MAC Address       MAC Info/       Interface     Endpoint Group</span>
<span class="go">      Domain      VLAN            IP Address        IP Info                       Info</span>
<span class="go">+---------------+---------------+-----------------+--------------+-------------+------------------------------+</span>
</pre></div>
</div>
<p>Additionally, viewing the output of &#8220;show vlan&#8221; and grepping for the Test EPG,
the interface that is expected to be configured with the EPG is not visible in
the interfaces that the policy should be programmed on.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show vlan | grep Test</span>
<span class="go"> 39   Test:CommerceWorkspaceTest:Web   active    Eth1/42, Eth1/44, Po1</span>
</pre></div>
</div>
<p>Inspecting the configuration on the Attachable Entity Profile for the
interface group used on the UCS shows that no vSwitch policy is configured for
the LLDP, CDP or LACP policies. Without these policies, the defaults will be
inherited from the AEP itself, and as a result will be configured to run LLDP
using whatever link aggregation protocol is used on the upstream links. This
will cause the VDS to inherit these properties, and thus run incorrectly.</p>
<a class="reference internal image-reference" href="_images/ScreenShot2014-10-16at2.51.07PM.png"><img alt="_images/ScreenShot2014-10-16at2.51.07PM.png" class="align-center" src="_images/ScreenShot2014-10-16at2.51.07PM.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>By right clicking on the Attachable Entity Profile and clicking the &#8220;Config
vSwitch Policies&#8221; it is possible to associate override policies for the
vSwitch. When using a UCS between the leaf and ESX hosts, these should be
configured to disable LLDP, enable CDP and use Mac Pinning as the LACP policy,
as shown below:</p>
<a class="reference internal image-reference" href="_images/ScreenShot2014-10-16at2.24.28PM.png"><img alt="_images/ScreenShot2014-10-16at2.24.28PM.png" class="align-center" src="_images/ScreenShot2014-10-16at2.24.28PM.png" style="width: 750px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>With the override in place, inspecting the endpoint table on the switch itself
shows that the MAC address for the VM has been learned and the VLAN table
shows that the interface where the EPG can be learned is correctly placed in
the CommerceWorkspaceTest:Web EPG.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">rtp_leaf1# show vlan | grep Test</span>
<span class="go"> 14   Test:CommerceWorkspaceTest:Web   active    Eth1/27, Eth1/28, Po2, Po3</span>

<span class="go">rtp_leaf1# show endpoint detail</span>
<span class="go">Legend:</span>
<span class="go"> O - peer-attached    H - vtep             a - locally-aged     S - static</span>
<span class="go"> V - vpc-attached     p - peer-aged        L - local            M - span</span>
<span class="go"> s - static-arp       B - bounce</span>
<span class="go">+---------------+---------------+-----------------+--------------+-------------+------------------------------+</span>
<span class="go">      VLAN/       Encap           MAC Address       MAC Info/       Interface     Endpoint Group</span>
<span class="go">      Domain      VLAN            IP Address        IP Info                       Info\</span>
<span class="go">+---------------+---------------+-----------------+--------------+-------------+------------------------------+</span>
<span class="go">14                      vlan-639    0050.56bb.d508 LV                        po2 Test:CommerceWorkspaceTest:Web</span>
</pre></div>
</div>
<p>Further verification from the host itself shows that ping to the gateway is
successful.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="l4l7.html" class="btn btn-neutral float-right" title="L4-L7 Service Insertion">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="routed2ext.html" class="btn btn-neutral" title="Routed Connectivity to External Networks"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Andres Vega, Bryan Deaver, Jerry Ye, Kannan Ponnuswamy, Loy Evans, Mike Timm, Paul Lesiak and Paul Raytick.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>